!function(root,factory){"function"==typeof define&&define.amd?define(["fullpagebus"],factory):(root.TIBR||(root.TIBR=function(){}),root.TIBR.__pageBus=factory(root))}(this,function(root){var OpenAjax=new function(){this.hub={},h=this.hub,h.implementer="http://openajax.org",h.implVersion="2.0",h.specVersion="2.0",h.implExtraData={}
    var libs={}
    h.libraries=libs
    var ooh="org.openajax.hub."
    h.registerLibrary=function(prefix,nsURL,version,extra){libs[prefix]={prefix:prefix,namespaceURI:nsURL,version:version,extraData:extra},this.publish(ooh+"registerLibrary",libs[prefix])},h.unregisterLibrary=function(prefix){this.publish(ooh+"unregisterLibrary",libs[prefix]),delete libs[prefix]}}
    if(OpenAjax.hub.Error={BadParameters:"OpenAjax.hub.Error.BadParameters",Disconnected:"OpenAjax.hub.Error.Disconnected",Duplicate:"OpenAjax.hub.Error.Duplicate",NoContainer:"OpenAjax.hub.Error.NoContainer",NoSubscription:"OpenAjax.hub.Error.NoSubscription",NotAllowed:"OpenAjax.hub.Error.NotAllowed",WrongProtocol:"OpenAjax.hub.Error.WrongProtocol"},OpenAjax.hub.SecurityAlert={LoadTimeout:"OpenAjax.hub.SecurityAlert.LoadTimeout",FramePhish:"OpenAjax.hub.SecurityAlert.FramePhish",ForgedMsg:"OpenAjax.hub.SecurityAlert.ForgedMsg"},OpenAjax.hub._debugger=function(){OpenAjax.hub.enableDebug},OpenAjax.hub.ManagedHub=function(params){if(!params||!params.onPublish||!params.onSubscribe)throw Error(OpenAjax.hub.Error.BadParameters)
        if(this._p=params,this._onUnsubscribe=params.onUnsubscribe?params.onUnsubscribe:null,this._scope=params.scope||window,params.log){var scope=this._scope,logfunc=params.log
            this._log=function(msg){logfunc.call(scope,"ManagedHub: "+msg)}}else this._log=function(){}
        this._subscriptions={c:{},s:null},this._containers={},this._seq=0,this._active=!0,this._isPublishing=!1,this._pubQ=[]},OpenAjax.hub.ManagedHub.prototype.subscribeForClient=function(container,topic,containerSubID){if(this._assertConn(),this._invokeOnSubscribe(topic,container))return this._subscribe(topic,this._sendToClient,this,{c:container,sid:containerSubID})
        throw Error(OpenAjax.hub.Error.NotAllowed)},OpenAjax.hub.ManagedHub.prototype.unsubscribeForClient=function(container,managerSubID){this._unsubscribe(managerSubID),this._invokeOnUnsubscribe(container,managerSubID)},OpenAjax.hub.ManagedHub.prototype.publishForClient=function(container,topic,data){this._assertConn(),this._publish(topic,data,container)},OpenAjax.hub.ManagedHub.prototype.disconnect=function(){this._active=!1
        for(var c in this._containers)this.removeContainer(this._containers[c])},OpenAjax.hub.ManagedHub.prototype.getContainer=function(containerId){var container=this._containers[containerId]
        return container?container:null},OpenAjax.hub.ManagedHub.prototype.listContainers=function(){var res=[]
        for(var c in this._containers)res.push(this._containers[c])
        return res},OpenAjax.hub.ManagedHub.prototype.addContainer=function(container){this._assertConn()
        var containerId=container.getClientID()
        if(this._containers[containerId])throw Error(OpenAjax.hub.Error.Duplicate)
        this._containers[containerId]=container},OpenAjax.hub.ManagedHub.prototype.removeContainer=function(container){var containerId=container.getClientID()
        if(!this._containers[containerId])throw Error(OpenAjax.hub.Error.NoContainer)
        container.remove(),delete this._containers[containerId]},OpenAjax.hub.ManagedHub.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){function publishCB(topic,data,sd,pcont){if(that._invokeOnPublish(topic,data,pcont,null))try{onData.call(scope,topic,data,subscriberData)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onData callback to Hub.subscribe(): "+e.message)}}if(this._assertConn(),this._assertSubTopic(topic),!onData)throw Error(OpenAjax.hub.Error.BadParameters)
        if(!this._invokeOnSubscribe(topic,null))return this._invokeOnComplete(onComplete,scope,null,!1,OpenAjax.hub.Error.NotAllowed),void 0
        scope=scope||window
        var that=this,subID=this._subscribe(topic,publishCB,scope,subscriberData)
        return this._invokeOnComplete(onComplete,scope,subID,!0),subID},OpenAjax.hub.ManagedHub.prototype.publish=function(topic,data){this._assertConn(),this._assertPubTopic(topic),this._publish(topic,data,null)},OpenAjax.hub.ManagedHub.prototype.unsubscribe=function(subscriptionID,onComplete,scope){if(this._assertConn(),void 0===subscriptionID||null==subscriptionID)throw Error(OpenAjax.hub.Error.BadParameters)
        this._unsubscribe(subscriptionID),this._invokeOnUnsubscribe(null,subscriptionID),this._invokeOnComplete(onComplete,scope,subscriptionID,!0)},OpenAjax.hub.ManagedHub.prototype.isConnected=function(){return this._active},OpenAjax.hub.ManagedHub.prototype.getScope=function(){return this._scope},OpenAjax.hub.ManagedHub.prototype.getSubscriberData=function(subscriberID){this._assertConn()
        var path=subscriberID.split("."),sid=path.pop(),sub=this._getSubscriptionObject(this._subscriptions,path,0,sid)
        if(sub)return sub.data
        throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.ManagedHub.prototype.getSubscriberScope=function(subscriberID){this._assertConn()
        var path=subscriberID.split("."),sid=path.pop(),sub=this._getSubscriptionObject(this._subscriptions,path,0,sid)
        if(sub)return sub.scope
        throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.ManagedHub.prototype.getParameters=function(){return this._p},OpenAjax.hub.ManagedHub.prototype._sendToClient=function(topic,data,sd,pcont){this.isConnected()&&this._invokeOnPublish(topic,data,pcont,sd.c)&&sd.c.sendToClient(topic,data,sd.sid)},OpenAjax.hub.ManagedHub.prototype._assertConn=function(){if(!this.isConnected())throw Error(OpenAjax.hub.Error.Disconnected)},OpenAjax.hub.ManagedHub.prototype._assertPubTopic=function(topic){if(null==topic||""==topic||-1!=topic.indexOf("*")||-1!=topic.indexOf("..")||"."==topic.charAt(0)||"."==topic.charAt(topic.length-1))throw Error(OpenAjax.hub.Error.BadParameters)},OpenAjax.hub.ManagedHub.prototype._assertSubTopic=function(topic){if(!topic)throw Error(OpenAjax.hub.Error.BadParameters)
        for(var path=topic.split("."),len=path.length,i=0;len>i;i++){var p=path[i]
            if(""==p||-1!=p.indexOf("*")&&"*"!=p&&"**"!=p)throw Error(OpenAjax.hub.Error.BadParameters)
            if("**"==p&&len-1>i)throw Error(OpenAjax.hub.Error.BadParameters)}},OpenAjax.hub.ManagedHub.prototype._invokeOnComplete=function(func,scope,item,success,errorCode){if(func)try{scope=scope||window,func.call(scope,item,success,errorCode)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onComplete callback: "+e.message)}},OpenAjax.hub.ManagedHub.prototype._invokeOnPublish=function(topic,data,pcont,scont){try{return this._p.onPublish.call(this._scope,topic,data,pcont,scont)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onPublish callback to constructor: "+e.message)}return!1},OpenAjax.hub.ManagedHub.prototype._invokeOnSubscribe=function(topic,container){try{return this._p.onSubscribe.call(this._scope,topic,container)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onSubscribe callback to constructor: "+e.message)}return!1},OpenAjax.hub.ManagedHub.prototype._invokeOnUnsubscribe=function(container,managerSubID){if(this._onUnsubscribe){var topic=managerSubID.slice(0,managerSubID.lastIndexOf("."))
        try{this._onUnsubscribe.call(this._scope,topic,container)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onUnsubscribe callback to constructor: "+e.message)}}},OpenAjax.hub.ManagedHub.prototype._subscribe=function(topic,onData,scope,subscriberData){var handle=topic+"."+this._seq,sub={scope:scope,cb:onData,data:subscriberData,sid:this._seq++},path=topic.split(".")
        return this._recursiveSubscribe(this._subscriptions,path,0,sub),handle},OpenAjax.hub.ManagedHub.prototype._recursiveSubscribe=function(tree,path,index,sub){var token=path[index]
        index==path.length?(sub.next=tree.s,tree.s=sub):(void 0===tree.c&&(tree.c={}),void 0===tree.c[token]?(tree.c[token]={c:{},s:null},this._recursiveSubscribe(tree.c[token],path,index+1,sub)):this._recursiveSubscribe(tree.c[token],path,index+1,sub))},OpenAjax.hub.ManagedHub.prototype._publish=function(topic,data,pcont){if(this._isPublishing)return this._pubQ.push({t:topic,d:data,p:pcont}),void 0
        for(this._safePublish(topic,data,pcont);this._pubQ.length>0;){var pub=this._pubQ.shift()
            this._safePublish(pub.t,pub.d,pub.p)}},OpenAjax.hub.ManagedHub.prototype._safePublish=function(topic,data,pcont){this._isPublishing=!0
        var path=topic.split(".")
        this._recursivePublish(this._subscriptions,path,0,topic,data,pcont),this._isPublishing=!1},OpenAjax.hub.ManagedHub.prototype._recursivePublish=function(tree,path,index,name,msg,pcont){if(void 0!==tree){var node
        if(index==path.length?node=tree:(this._recursivePublish(tree.c[path[index]],path,index+1,name,msg,pcont),this._recursivePublish(tree.c["*"],path,index+1,name,msg,pcont),node=tree.c["**"]),void 0!==node)for(var sub=node.s;sub;){var sc=sub.scope,cb=sub.cb,d=sub.data
            sub.sid,"string"==typeof cb&&(cb=sc[cb]),cb.call(sc,name,msg,d,pcont),sub=sub.next}}},OpenAjax.hub.ManagedHub.prototype._unsubscribe=function(subscriptionID){var path=subscriptionID.split("."),sid=path.pop()
        if(!this._recursiveUnsubscribe(this._subscriptions,path,0,sid))throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.ManagedHub.prototype._recursiveUnsubscribe=function(tree,path,index,sid){if(void 0===tree)return!1
        if(index<path.length){var childNode=tree.c[path[index]]
            if(!childNode)return!1
            if(this._recursiveUnsubscribe(childNode,path,index+1,sid),null==childNode.s){for(var x in childNode.c)return!0
                delete tree.c[path[index]]}}else{for(var sub=tree.s,sub_prev=null,found=!1;sub;){if(sid==sub.sid){found=!0,sub==tree.s?tree.s=sub.next:sub_prev.next=sub.next
            break}sub_prev=sub,sub=sub.next}if(!found)return!1}return!0},OpenAjax.hub.ManagedHub.prototype._getSubscriptionObject=function(tree,path,index,sid){if(void 0!==tree){if(index<path.length){var childNode=tree.c[path[index]]
        return this._getSubscriptionObject(childNode,path,index+1,sid)}for(var sub=tree.s;sub;){if(sid==sub.sid)return sub
        sub=sub.next}}return null},OpenAjax.hub._hub=new OpenAjax.hub.ManagedHub({onSubscribe:function(){return!0},onPublish:function(){return!0}}),OpenAjax.hub.subscribe=function(topic,onData,scope,subscriberData){return"string"==typeof onData&&(scope=scope||window,onData=scope[onData]||null),OpenAjax.hub._hub.subscribe(topic,onData,scope,null,subscriberData)},OpenAjax.hub.unsubscribe=function(subscriptionID){return OpenAjax.hub._hub.unsubscribe(subscriptionID)},OpenAjax.hub.publish=function(topic,data){OpenAjax.hub._hub.publish(topic,data)},OpenAjax.hub.registerLibrary("OpenAjax","http://openajax.org/hub","2.0",{}),OpenAjax.hub.InlineContainer=function(hub,clientID,params){if(!(hub&&clientID&&params&&params.Container&&params.Container.onSecurityAlert))throw Error(OpenAjax.hub.Error.BadParameters)
        if(this._params=params,this._hub=hub,this._id=clientID,this._onSecurityAlert=params.Container.onSecurityAlert,this._onConnect=params.Container.onConnect?params.Container.onConnect:null,this._onDisconnect=params.Container.onDisconnect?params.Container.onDisconnect:null,this._scope=params.Container.scope||window,params.Container.log){var scope=this._scope,logfunc=params.Container.log
            this._log=function(msg){logfunc.call(scope,"InlineContainer::"+clientID+": "+msg)},this._doLog=!0}else this._log=function(){}
        this._connected=!1,this._subs=[],this._subIndex=1,hub.addContainer(this)},OpenAjax.hub.InlineContainer.prototype.getHub=function(){return this._hub},OpenAjax.hub.InlineContainer.prototype.sendToClient=function(topic,data,subscriptionID){if(this.isConnected()){var sub=this._subs[subscriptionID]
        try{sub.cb.call(sub.sc,topic,data,sub.d)}catch(e){OpenAjax.hub._debugger(),this._client._log("caught error from onData callback to HubClient.subscribe(): "+e.message)}}},OpenAjax.hub.InlineContainer.prototype.remove=function(){this.isConnected()&&this._disconnect()},OpenAjax.hub.InlineContainer.prototype.isConnected=function(){return this._connected},OpenAjax.hub.InlineContainer.prototype.getClientID=function(){return this._id},OpenAjax.hub.InlineContainer.prototype.getPartnerOrigin=function(){return this._connected?(this._cacheOrig||(this._cacheOrig=window.location.protocol+"//"+window.location.hostname),this._cacheOrig):null},OpenAjax.hub.InlineContainer.prototype.getParameters=function(){return this._params},OpenAjax.hub.InlineContainer.prototype.connect=function(client,onComplete,scope){if(this._connected)throw Error(OpenAjax.hub.Error.Duplicate)
        if(this._connected=!0,this._client=client,this._onConnect)try{this._onConnect.call(this._scope,this)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onConnect callback to constructor: "+e.message)}this._invokeOnComplete(onComplete,scope,client,!0)},OpenAjax.hub.InlineContainer.prototype.disconnect=function(client,onComplete,scope){if(!this._connected)throw Error(OpenAjax.hub.Error.Disconnected)
        if(this._disconnect(),this._onDisconnect)try{this._onDisconnect.call(this._scope,this)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onDisconnect callback to constructor: "+e.message)}this._invokeOnComplete(onComplete,scope,client,!0)},OpenAjax.hub.InlineContainer.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){if(this._assertConn(),this._assertSubTopic(topic),!onData)throw Error(OpenAjax.hub.Error.BadParameters)
        var subID=""+this._subIndex++,success=!1,msg=null
        try{var handle=this._hub.subscribeForClient(this,topic,subID)
            success=!0}catch(e){subID=null,msg=e.message}return scope=scope||window,success&&(this._subs[subID]={h:handle,cb:onData,sc:scope,d:subscriberData}),this._invokeOnComplete(onComplete,scope,subID,success,msg),subID},OpenAjax.hub.InlineContainer.prototype.publish=function(topic,data){this._assertConn(),this._assertPubTopic(topic),this._hub.publishForClient(this,topic,data)},OpenAjax.hub.InlineContainer.prototype.unsubscribe=function(subscriptionID,onComplete,scope){if(this._assertConn(),void 0===subscriptionID||null==subscriptionID)throw Error(OpenAjax.hub.Error.BadParameters)
        var sub=this._subs[subscriptionID]
        if(!sub)throw Error(OpenAjax.hub.Error.NoSubscription)
        this._hub.unsubscribeForClient(this,sub.h),delete this._subs[subscriptionID],this._invokeOnComplete(onComplete,scope,subscriptionID,!0)},OpenAjax.hub.InlineContainer.prototype.getSubscriberData=function(subID){return this._assertConn(),this._getSubscription(subID).d},OpenAjax.hub.InlineContainer.prototype.getSubscriberScope=function(subID){return this._assertConn(),this._getSubscription(subID).sc},OpenAjax.hub.InlineContainer.prototype._invokeOnComplete=function(func,scope,item,success,errorCode){if(func)try{scope=scope||window,func.call(scope,item,success,errorCode)}catch(e){OpenAjax.hub._debugger(),this._client._log("caught error from onComplete callback: "+e.message)}},OpenAjax.hub.InlineContainer.prototype._disconnect=function(){for(var subID in this._subs)this._hub.unsubscribeForClient(this,this._subs[subID].h)
        this._subs=[],this._subIndex=1,this._connected=!1},OpenAjax.hub.InlineContainer.prototype._assertConn=function(){if(!this._connected)throw Error(OpenAjax.hub.Error.Disconnected)},OpenAjax.hub.InlineContainer.prototype._assertPubTopic=function(topic){if(null==topic||""==topic||-1!=topic.indexOf("*")||-1!=topic.indexOf("..")||"."==topic.charAt(0)||"."==topic.charAt(topic.length-1))throw Error(OpenAjax.hub.Error.BadParameters)},OpenAjax.hub.InlineContainer.prototype._assertSubTopic=function(topic){if(!topic)throw Error(OpenAjax.hub.Error.BadParameters)
        for(var path=topic.split("."),len=path.length,i=0;len>i;i++){var p=path[i]
            if(""==p||-1!=p.indexOf("*")&&"*"!=p&&"**"!=p)throw Error(OpenAjax.hub.Error.BadParameters)
            if("**"==p&&len-1>i)throw Error(OpenAjax.hub.Error.BadParameters)}},OpenAjax.hub.InlineContainer.prototype._getSubscription=function(subID){var sub=this._subs[subID]
        if(sub)return sub
        throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.InlineHubClient=function(params){if(!(params&&params.HubClient&&params.HubClient.onSecurityAlert&&params.InlineHubClient&&params.InlineHubClient.container))throw Error(OpenAjax.hub.Error.BadParameters)
        if(this._params=params,this._onSecurityAlert=params.HubClient.onSecurityAlert,this._scope=params.HubClient.scope||window,this._container=params.InlineHubClient.container,params.HubClient.log){var id=this._container.getClientID(),scope=this._scope,logfunc=params.HubClient.log
            this._log=function(msg){logfunc.call(scope,"InlineHubClient::"+id+": "+msg)},this._doLog=!0}else this._log=function(){}},OpenAjax.hub.InlineHubClient.prototype.connect=function(onComplete,scope){this._container.connect(this,onComplete,scope)},OpenAjax.hub.InlineHubClient.prototype.disconnect=function(onComplete,scope){this._container.disconnect(this,onComplete,scope)},OpenAjax.hub.InlineHubClient.prototype.getPartnerOrigin=function(){return this._container.getPartnerOrigin()},OpenAjax.hub.InlineHubClient.prototype.getClientID=function(){return this._container.getClientID()},OpenAjax.hub.InlineHubClient.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){return this._container.subscribe(topic,onData,scope,onComplete,subscriberData)},OpenAjax.hub.InlineHubClient.prototype.publish=function(topic,data){this._container.publish(topic,data)},OpenAjax.hub.InlineHubClient.prototype.unsubscribe=function(subscriptionID,onComplete,scope){this._container.unsubscribe(subscriptionID,onComplete,scope)},OpenAjax.hub.InlineHubClient.prototype.isConnected=function(){return this._container.isConnected()},OpenAjax.hub.InlineHubClient.prototype.getScope=function(){return this._scope},OpenAjax.hub.InlineHubClient.prototype.getSubscriberData=function(subID){return this._container.getSubscriberData(subID)},OpenAjax.hub.InlineHubClient.prototype.getSubscriberScope=function(subID){return this._container.getSubscriberScope(subID)},OpenAjax.hub.InlineHubClient.prototype.getParameters=function(){return this._params},void 0===OpenAjax&&(OpenAjax={hub:{}}),OpenAjax.hub.IframeContainer=function(hub,clientID,params){if(!(hub&&clientID&&params&&params.Container&&params.Container.onSecurityAlert&&params.IframeContainer&&params.IframeContainer.parent&&params.IframeContainer.uri&&params.IframeContainer.tunnelURI))throw Error(OpenAjax.hub.Error.BadParameters)
        this._params=params,this._id=clientID,this._delegate=window.postMessage?new OpenAjax.hub.IframePMContainer(this,hub,clientID,params):new OpenAjax.hub.IframeFIMContainer(this,hub,clientID,params),this._iframe=this._createIframe(params.IframeContainer.parent,this._delegate.getURI(),params.IframeContainer.iframeAttrs),hub.addContainer(this)},OpenAjax.hub.IframeContainer.prototype.getHub=function(){return this._delegate.getHub()},OpenAjax.hub.IframeContainer.prototype.sendToClient=function(topic,data,subscriptionID){this._delegate.sendToClient(topic,data,subscriptionID)},OpenAjax.hub.IframeContainer.prototype.remove=function(){this._delegate.remove(),this._iframe.parentNode.removeChild(this._iframe)},OpenAjax.hub.IframeContainer.prototype.isConnected=function(){return this._delegate.isConnected()},OpenAjax.hub.IframeContainer.prototype.getClientID=function(){return this._id},OpenAjax.hub.IframeContainer.prototype.getPartnerOrigin=function(){return this._delegate.getPartnerOrigin()},OpenAjax.hub.IframeContainer.prototype.getParameters=function(){return this._params},OpenAjax.hub.IframeContainer.prototype.getIframe=function(){return this._iframe},OpenAjax.hub.IframeContainer.bind=function(toWhom,callback){var __method=callback
        return function(){return __method.apply(toWhom,arguments)}},OpenAjax.hub.IframeContainer.prototype._createIframe=function(parent,src,attrs){var iframe=document.createElement("iframe")
        if(attrs)for(var attr in attrs)if("style"==attr)for(var style in attrs.style)iframe.style[style]=attrs.style[style]
        else iframe[attr]=attrs[attr]
        return iframe.style.visibility="hidden",iframe.src='javascript:"<html></html>"',parent.appendChild(iframe),iframe.src=src,iframe},OpenAjax.hub.IframeHubClient=function(params){if(!params||!params.HubClient||!params.HubClient.onSecurityAlert)throw Error(OpenAjax.hub.Error.BadParameters)
        this._params=params,this._delegate=window.postMessage?new OpenAjax.hub.IframePMHubClient(this,params):new OpenAjax.hub.IframeFIMHubClient(this,params)},OpenAjax.hub.IframeHubClient.prototype.connect=function(onComplete,scope){if(scope=scope||window,this.isConnected())throw Error(OpenAjax.hub.Error.Duplicate)
        this._delegate.connect(onComplete,scope)},OpenAjax.hub.IframeHubClient.prototype.disconnect=function(onComplete,scope){if(scope=scope||window,!this.isConnected())throw Error(OpenAjax.hub.Error.Disconnected)
        this._delegate.disconnect(onComplete,scope)},OpenAjax.hub.IframeHubClient.prototype.getPartnerOrigin=function(){return this._delegate.getPartnerOrigin()},OpenAjax.hub.IframeHubClient.prototype.getClientID=function(){return this._delegate.getClientID()},OpenAjax.hub.IframeHubClient.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){if(this._assertConn(),this._assertSubTopic(topic),!onData)throw Error(OpenAjax.hub.Error.BadParameters)
        return scope=scope||window,this._delegate.subscribe(topic,onData,scope,onComplete,subscriberData)},OpenAjax.hub.IframeHubClient.prototype.publish=function(topic,data){this._assertConn(),this._assertPubTopic(topic),this._delegate.publish(topic,data)},OpenAjax.hub.IframeHubClient.prototype.unsubscribe=function(subscriptionID,onComplete,scope){if(this._assertConn(),void 0===subscriptionID||null==subscriptionID)throw Error(OpenAjax.hub.Error.BadParameters)
        scope=scope||window,this._delegate.unsubscribe(subscriptionID,onComplete,scope)},OpenAjax.hub.IframeHubClient.prototype.isConnected=function(){return this._delegate.isConnected()},OpenAjax.hub.IframeHubClient.prototype.getScope=function(){return this._delegate.getScope()},OpenAjax.hub.IframeHubClient.prototype.getSubscriberData=function(subscriptionID){return this._assertConn(),this._delegate.getSubscriberData(subscriptionID)},OpenAjax.hub.IframeHubClient.prototype.getSubscriberScope=function(subscriptionID){return this._assertConn(),this._delegate.getSubscriberScope(subscriptionID)},OpenAjax.hub.IframeHubClient.prototype.getParameters=function(){return this._params},OpenAjax.hub.IframeHubClient.prototype._assertConn=function(){if(!this.isConnected())throw Error(OpenAjax.hub.Error.Disconnected)},OpenAjax.hub.IframeHubClient.prototype._assertSubTopic=function(topic){if(!topic)throw Error(OpenAjax.hub.Error.BadParameters)
        for(var path=topic.split("."),len=path.length,i=0;len>i;i++){var p=path[i]
            if(""==p||-1!=p.indexOf("*")&&"*"!=p&&"**"!=p)throw Error(OpenAjax.hub.Error.BadParameters)
            if("**"==p&&len-1>i)throw Error(OpenAjax.hub.Error.BadParameters)}},OpenAjax.hub.IframeHubClient.prototype._assertPubTopic=function(topic){if(null==topic||""==topic||-1!=topic.indexOf("*")||-1!=topic.indexOf("..")||"."==topic.charAt(0)||"."==topic.charAt(topic.length-1))throw Error(OpenAjax.hub.Error.BadParameters)},OpenAjax.hub.IframePMContainer=function(container,hub,clientID,params){if(this._container=container,this._hub=hub,this._id=clientID,this._onSecurityAlert=params.Container.onSecurityAlert,this._onConnect=params.Container.onConnect?params.Container.onConnect:null,this._onDisconnect=params.Container.onDisconnect?params.Container.onDisconnect:null,this._scope=params.Container.scope||window,this._uri=params.IframeContainer.uri,this._tunnelURI=params.IframeContainer.tunnelURI,this._timeout=params.IframeContainer.timeout||15e3,params.Container.log){var scope=this._scope,logfunc=params.Container.log
        this._log=function(msg){logfunc.call(scope,"IframeContainer::"+clientID+": "+msg)},this._doLog=!0}else this._log=function(){}
        this._securityToken=this._generateSecurityToken(params),this._connected=!1,this._subs={},void 0===OpenAjax.hub.IframePMContainer._pmCapabilities&&this._testPostMessage(),this._postMessage=-1==OpenAjax.hub.IframePMContainer._pmCapabilities.indexOf("s")?function(win,msg,origin){win.postMessage(msg,origin)}:function(win,msg,origin){setTimeout(function(){win.postMessage(msg,origin)},0)},OpenAjax.hub.IframePMContainer._pmListener||(OpenAjax.hub.IframePMContainer._pmListener=new OpenAjax.hub.IframePMContainer.PMListener),this._internalID=OpenAjax.hub.IframePMContainer._pmListener.addContainer(this),this._startLoadTimer()},OpenAjax.hub.IframePMContainer.protocolID="openajax-2.0",OpenAjax.hub.IframePMContainer._pmListener=null,OpenAjax.hub.IframePMContainer.prototype.getHub=function(){return this._hub},OpenAjax.hub.IframePMContainer.prototype.sendToClient=function(topic,data,subscriptionID){this._sendMessage("pub",{t:topic,d:data,s:subscriptionID})},OpenAjax.hub.IframePMContainer.prototype.remove=function(){this._disconnect(),OpenAjax.hub.IframePMContainer._pmListener.removeContainer(this._internalID),clearTimeout(this._loadTimer)},OpenAjax.hub.IframePMContainer.prototype.isConnected=function(){return this._connected},OpenAjax.hub.IframePMContainer.prototype.getPartnerOrigin=function(){return this._connected?this._partnerOriginNoPort:null},OpenAjax.hub.IframePMContainer.prototype.receiveMessage=function(event,msg){if(msg.t!=this._securityToken||void 0!==this._partnerOrigin&&!OpenAjax.hub.IframePMContainer.originMatches(this,event))return this._invokeSecurityAlert(OpenAjax.hub.SecurityAlert.ForgedMsg),void 0
        switch(this._doLog&&this._log("received message: ["+event.data+"]"),msg.m){case"sub":var errCode=""
            try{this._subs[msg.p.s]=this._hub.subscribeForClient(this._container,msg.p.t,msg.p.s)}catch(e){errCode=e.message}this._sendMessage("sub_ack",{s:msg.p.s,e:errCode})
            break
            case"pub":this._hub.publishForClient(this._container,msg.p.t,msg.p.d)
                break
            case"uns":var handle=this._subs[msg.p.s]
                this._hub.unsubscribeForClient(this._container,handle),delete this._subs[msg.p.s],this._sendMessage("uns_ack",msg.p.s)
                break
            case"dis":if(this._startLoadTimer(),this._disconnect(),this._sendMessage("dis_ack",null),this._onDisconnect)try{this._onDisconnect.call(this._scope,this._container)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onDisconnect callback to constructor: "+e.message)}}},OpenAjax.hub.IframePMContainer.prototype.connect=function(origin,securityToken,tunnelWindow){if(this._log("client connecting to container "+this._id+" :: origin = "+origin+" :: securityToken = "+securityToken),securityToken!=this._securityToken)return this._invokeSecurityAlert(OpenAjax.hub.SecurityAlert.ForgedMsg),void 0
        var that=this
        if(tunnelWindow.onunload=function(){that.isConnected()&&setTimeout(function(){that._invokeSecurityAlert(OpenAjax.hub.SecurityAlert.FramePhish)},1)},clearTimeout(this._loadTimer),this._iframe=this._container.getIframe(),this._iframe.style.visibility="visible",this._partnerOrigin=origin,this._partnerOriginNoPort=RegExp("^([a-zA-Z]+://[^:]+).*").exec(this._partnerOrigin)[1],-1!=OpenAjax.hub.IframePMContainer._pmCapabilities.indexOf("d")&&(this._partnerDomain=RegExp("^.+://([^:]+).*").exec(this._partnerOrigin)[1]),this._sendMessage("con_ack",null),this._connected=!0,this._onConnect)try{this._onConnect.call(this._scope,this._container)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onConnect callback to constructor: "+e.message)}},OpenAjax.hub.IframePMContainer.prototype.getURI=function(){var paramStr="oahpv="+encodeURIComponent(OpenAjax.hub.IframePMContainer.protocolID)+"&oahi="+encodeURIComponent(this._internalID)+"&oaht="+this._securityToken+"&oahu="+encodeURIComponent(this._tunnelURI)+"&oahpm="+OpenAjax.hub.IframePMContainer._pmCapabilities
        this._id!==this._internalID&&(paramStr+="&oahj="+this._internalID),paramStr+=OpenAjax.hub.enableDebug?"&oahd=true":""
        var parts=this._uri.split("#")
        return parts[0]=parts[0]+(-1!=parts[0].indexOf("?")?"&":"?")+paramStr,1==parts.length?parts[0]:parts[0]+"#"+parts[1]},OpenAjax.hub.IframePMContainer.originMatches=function(obj,event){return event.origin?event.origin==obj._partnerOrigin:event.domain==obj._partnerDomain},OpenAjax.hub.IframePMContainer.prototype._generateSecurityToken=function(params){if(!OpenAjax.hub.IframePMContainer._prng){var seed=(new Date).getTime()+Math.random()+document.cookie
        OpenAjax.hub.IframePMContainer._prng=smash.crypto.newPRNG(seed)}if(params.IframeContainer.seed)try{var extraSeed=params.IframeContainer.seed.call(this._scope)
        OpenAjax.hub.IframePMContainer._prng.addSeed(extraSeed)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from 'seed' callback: "+e.message)}var tokenLength=params.IframeContainer.tokenLength||6
        return OpenAjax.hub.IframePMContainer._prng.nextRandomB64Str(tokenLength)},OpenAjax.hub.IframePMContainer.prototype._testPostMessage=function(){function receiveMsg(event){"postmessage.test"==event.data&&(hit=!0,void 0===event.origin&&(OpenAjax.hub.IframePMContainer._pmCapabilities+="d"))}OpenAjax.hub.IframePMContainer._pmCapabilities=""
        var hit=!1
        window.addEventListener?window.addEventListener("message",receiveMsg,!1):window.attachEvent&&window.attachEvent("onmessage",receiveMsg),window.postMessage("postmessage.test","*"),hit&&(OpenAjax.hub.IframePMContainer._pmCapabilities+="s"),window.removeEventListener?window.removeEventListener("message",receiveMsg,!1):window.detachEvent("onmessage",receiveMsg)},OpenAjax.hub.IframePMContainer.prototype._startLoadTimer=function(){var that=this
        this._loadTimer=setTimeout(function(){OpenAjax.hub.IframePMContainer._pmListener.removeContainer(that._internalID),that._invokeSecurityAlert(OpenAjax.hub.SecurityAlert.LoadTimeout)},this._timeout)},OpenAjax.hub.IframePMContainer.prototype._sendMessage=function(type,payload){var msg=JSON.stringify({m:type,i:this._internalID,t:this._securityToken,p:payload})
        this._postMessage(this._iframe.contentWindow,msg,this._partnerOrigin)},OpenAjax.hub.IframePMContainer.prototype._disconnect=function(){if(this._connected){this._connected=!1,this._iframe.style.visibility="hidden"
        for(var sub in this._subs)this._hub.unsubscribeForClient(this._container,this._subs[sub])
        this._subs={}}},OpenAjax.hub.IframePMContainer.prototype._invokeSecurityAlert=function(errorMsg){try{this._onSecurityAlert.call(this._scope,this._container,errorMsg)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onSecurityAlert callback to constructor: "+e.message)}},OpenAjax.hub.IframePMContainer.PMListener=function(){this._containers={},window.addEventListener?window.addEventListener("message",OpenAjax.hub.IframeContainer.bind(this,this._receiveMessage),!1):window.attachEvent&&window.attachEvent("onmessage",OpenAjax.hub.IframeContainer.bind(this,this._receiveMessage))},OpenAjax.hub.IframePMContainer.PMListener.prototype.addContainer=function(container){for(var id=container._id;this._containers[id];)id=(0|32767*Math.random()).toString(16)+"_"+id
        return this._containers[id]=container,id},OpenAjax.hub.IframePMContainer.PMListener.prototype.removeContainer=function(internalID){delete this._containers[internalID]},OpenAjax.hub.IframePMContainer.PMListener.prototype.connectFromTunnel=function(internalID,origin,securityToken,tunnelWindow){this._containers[internalID]&&this._containers[internalID].connect(origin,securityToken,tunnelWindow)},OpenAjax.hub.IframePMContainer.PMListener.prototype._receiveMessage=function(event){try{var msg=JSON.parse(event.data)}catch(e){return}this._verifyMsg(msg)&&this._containers[msg.i]&&this._containers[msg.i].receiveMessage(event,msg)},OpenAjax.hub.IframePMContainer.PMListener.prototype._verifyMsg=function(msg){return"string"==typeof msg.m&&"string"==typeof msg.i&&"t"in msg&&"p"in msg},OpenAjax.hub.IframePMHubClient=function(client,params){if(this._checkProtocolID(),this._client=client,this._onSecurityAlert=params.HubClient.onSecurityAlert,this._scope=params.HubClient.scope||window,this._id=OpenAjax.hub.IframePMHubClient.queryURLParam("oahi"),this._internalID=OpenAjax.hub.IframePMHubClient.queryURLParam("oahj")||this._id,this._securityToken=OpenAjax.hub.IframePMHubClient.queryURLParam("oaht"),this._tunnelURI=OpenAjax.hub.IframePMHubClient.queryURLParam("oahu"),OpenAjax.hub.IframePMContainer._pmCapabilities=OpenAjax.hub.IframePMHubClient.queryURLParam("oahpm"),!this._id||!this._securityToken||!this._tunnelURI)throw Error(OpenAjax.hub.Error.WrongProtocol)
        if(OpenAjax.hub.IframePMHubClient.queryURLParam("oahd")&&(OpenAjax.hub.enableDebug=!0),this._partnerOrigin=RegExp("^([a-zA-Z]+://[^/?#]+).*").exec(this._tunnelURI)[1],this._partnerOriginNoPort=RegExp("^([a-zA-Z]+://[^:]+).*").exec(this._partnerOrigin)[1],-1!=OpenAjax.hub.IframePMContainer._pmCapabilities.indexOf("d")&&(this._partnerDomain=RegExp("^.+://([^:]+).*").exec(this._partnerOrigin)[1]),params.HubClient.log){var id=this._id,scope=this._scope,logfunc=params.HubClient.log
            this._log=function(msg){logfunc.call(scope,"IframeHubClient::"+id+": "+msg)},this._doLog=!0}else this._log=function(){}
        this._connected=!1,this._subs={},this._subIndex=1,this._postMessage=-1==OpenAjax.hub.IframePMContainer._pmCapabilities.indexOf("s")?function(win,msg,origin){win.postMessage(msg,origin)}:function(win,msg,origin){setTimeout(function(){win.postMessage(msg,origin)},0)}},OpenAjax.hub.IframePMHubClient.protocolID="openajax-2.0",OpenAjax.hub.IframePMHubClient.prototype.connect=function(onComplete,scope){onComplete&&(this._connectOnComplete={cb:onComplete,sc:scope}),this._msgListener=OpenAjax.hub.IframeContainer.bind(this,this._receiveMessage),window.addEventListener?window.addEventListener("message",this._msgListener,!1):window.attachEvent&&window.attachEvent("onmessage",this._msgListener)
        var origin=window.location.protocol+"//"+window.location.host,iframe=document.createElement("iframe")
        document.body.appendChild(iframe),iframe.src=this._tunnelURI+(-1==this._tunnelURI.indexOf("?")?"?":"&")+"oahj="+encodeURIComponent(this._internalID)+"&oaht="+this._securityToken+"&oaho="+encodeURIComponent(origin),iframe.style.position="absolute",iframe.style.left=iframe.style.top="-10px",iframe.style.height=iframe.style.width="1px",iframe.style.visibility="hidden",this._tunnelIframe=iframe},OpenAjax.hub.IframePMHubClient.prototype.disconnect=function(onComplete,scope){this._connected=!1,onComplete&&(this._disconnectOnComplete={cb:onComplete,sc:scope}),this._sendMessage("dis",null)},OpenAjax.hub.IframePMHubClient.prototype.getPartnerOrigin=function(){return this._connected?RegExp("^([a-zA-Z]+://[^:]+).*").exec(this._partnerOrigin)[1]:null},OpenAjax.hub.IframePMHubClient.prototype.getClientID=function(){return this._id},OpenAjax.hub.IframePMHubClient.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){var subID=""+this._subIndex++
        return this._subs[subID]={cb:onData,sc:scope,d:subscriberData,oc:onComplete},this._sendMessage("sub",{t:topic,s:subID}),subID},OpenAjax.hub.IframePMHubClient.prototype.publish=function(topic,data){this._sendMessage("pub",{t:topic,d:data})},OpenAjax.hub.IframePMHubClient.prototype.unsubscribe=function(subID,onComplete,scope){if(!this._subs[subID]||this._subs[subID].uns)throw Error(OpenAjax.hub.Error.NoSubscription)
        this._subs[subID].uns={cb:onComplete,sc:scope},this._sendMessage("uns",{s:subID})},OpenAjax.hub.IframePMHubClient.prototype.isConnected=function(){return this._connected},OpenAjax.hub.IframePMHubClient.prototype.getScope=function(){return this._scope},OpenAjax.hub.IframePMHubClient.prototype.getSubscriberData=function(subID){var sub=this._subs[subID]
        if(sub)return sub.d
        throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.IframePMHubClient.prototype.getSubscriberScope=function(subID){var sub=this._subs[subID]
        if(sub)return sub.sc
        throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.IframePMHubClient.queryURLParam=function(param){var result=RegExp("[\\?&]"+param+"=([^&#]*)").exec(window.location.search)
        return result?decodeURIComponent(result[1].replace(/\+/g,"%20")):null},OpenAjax.hub.IframePMHubClient.prototype._checkProtocolID=function(){var partnerProtocolID=OpenAjax.hub.IframePMHubClient.queryURLParam("oahpv")
        if(partnerProtocolID!=OpenAjax.hub.IframePMHubClient.protocolID)throw Error(OpenAjax.hub.Error.WrongProtocol)},OpenAjax.hub.IframePMHubClient.prototype._receiveMessage=function(event){try{var msg=JSON.parse(event.data)}catch(e){return}if(this._verifyMsg(msg)&&msg.i==this._internalID)if(OpenAjax.hub.IframePMContainer.originMatches(this,event)&&msg.t==this._securityToken)switch(this._doLog&&this._log("received message: ["+event.data+"]"),msg.m){case"sub_ack":var subID=msg.p.s,onComplete=this._subs[subID].oc
        if(onComplete)try{delete this._subs[subID].oc
            var scope=this._subs[subID].sc
            onComplete.call(scope,msg.p.s,""==msg.p.e,msg.p.e)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onComplete callback to HubClient.subscribe(): "+e.message)}break
        case"pub":var subID=msg.p.s
            if(this._subs[subID]&&!this._subs[subID].uns){var onData=this._subs[subID].cb,scope=this._subs[subID].sc,subscriberData=this._subs[subID].d
                try{onData.call(scope,msg.p.t,msg.p.d,subscriberData)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onData callback to HubClient.subscribe(): "+e.message)}}break
        case"uns_ack":var subID=msg.p
            if(this._subs[subID]){var onComplete=this._subs[subID].uns.cb
                if(onComplete)try{var scope=this._subs[subID].uns.sc
                    onComplete.call(scope,subID,!0)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onComplete callback to HubClient.unsubscribe(): "+e.message)}delete this._subs[subID]}break
        case"con_ack":if(this._connected=!0,this._connectOnComplete){var onComplete=this._connectOnComplete.cb,scope=this._connectOnComplete.sc
            try{onComplete.call(scope,this._client,!0)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onComplete callback to HubClient.connect(): "+e.message)}delete this._connectOnComplete}break
        case"dis_ack":if(window.removeEventListener?window.removeEventListener("message",this._msgListener,!1):window.detachEvent("onmessage",this._msgListener),delete this._msgListener,this._tunnelIframe.parentNode.removeChild(this._tunnelIframe),delete this._tunnelIframe,this._disconnectOnComplete){try{var onComplete=this._disconnectOnComplete.cb,scope=this._disconnectOnComplete.sc
            onComplete.call(scope,this._client,!0)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onComplete callback to HubClient.disconnect(): "+e.message)}delete this._disconnectOnComplete}}else try{this._onSecurityAlert.call(this._scope,this._client,OpenAjax.hub.SecurityAlert.ForgedMsg)}catch(e){OpenAjax.hub._debugger(),this._log("caught error from onSecurityAlert callback to constructor: "+e.message)}},OpenAjax.hub.IframePMHubClient.prototype._verifyMsg=function(msg){return"string"==typeof msg.m&&"t"in msg&&"p"in msg},OpenAjax.hub.IframePMHubClient.prototype._sendMessage=function(type,payload){var msg=JSON.stringify({m:type,i:this._internalID,t:this._securityToken,p:payload})
        this._postMessage(window.parent,msg,this._partnerOrigin)},void 0===OpenAjax&&(OpenAjax={hub:{}}),OpenAjax.hub.IframeFIMContainer=function(container,hub,clientID,params){if(this._container=container,this._hub=hub,this._onSecurityAlert=params.Container.onSecurityAlert,this._onConnect=params.Container.onConnect?params.Container.onConnect:null,this._onDisconnect=params.Container.onDisconnect?params.Container.onDisconnect:null,this._scope=params.Container.scope||window,this._clientURI=params.IframeContainer.uri,smash.SEComm.tunnelURI=params.IframeContainer.tunnelURI,smash._loadTimeout=params.IframeContainer.timeout||15e3,params.Container.log){var scope=this._scope,logfunc=params.Container.log
        this._log=function(msg){logfunc.call(scope,"IframeContainer::"+clientID+": "+msg)},this._doLog=!0}else this._log=function(){}
        smash._createPRNG(this,params),smash._ensureSingletonManager(),this._internalID=smash._singletonManager.generateUniqueClientName(clientID)},OpenAjax.hub.IframeFIMContainer.prototype.getHub=function(){return this._hub},OpenAjax.hub.IframeFIMContainer.prototype.sendToClient=function(topic,data,subscriptionID){smash._singletonManager.sendToClient(this._internalID,topic,data,[subscriptionID])},OpenAjax.hub.IframeFIMContainer.prototype.remove=function(){return smash._singletonManager.prepareForUnload(this._internalID)},OpenAjax.hub.IframeFIMContainer.prototype.isConnected=function(){return smash._singletonManager.isConnected(this._internalID)},OpenAjax.hub.IframeFIMContainer.prototype.getPartnerOrigin=function(){return smash._singletonManager.getPartnerOrigin(this._internalID)},OpenAjax.hub.IframeFIMContainer.prototype.getURI=function(){function errorCallback(clientID,error){var alertType=null
        switch(error){case smash.SecurityErrors.INVALID_TOKEN:case smash.SecurityErrors.TOKEN_VERIFICATION_FAILED:alertType=OpenAjax.hub.SecurityAlert.ForgedMsg
            break
            case smash.SecurityErrors.TUNNEL_UNLOAD:alertType=OpenAjax.hub.SecurityAlert.FramePhish
                break
            case smash.SecurityErrors.COMPONENT_LOAD:alertType=OpenAjax.hub.SecurityAlert.LoadTimeout}try{that._onSecurityAlert.call(that._scope,that._container,alertType)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onSecurityAlert callback to constructor: "+e.message)}}var that=this,newURI=smash._singletonManager.prepareForLoad({clientName:this._internalID,uri:this._clientURI,commErrorCallback:errorCallback,oaaContainer:this,log:this._log})
        return newURI&&OpenAjax.hub.enableDebug&&(newURI+=":debug"),newURI},OpenAjax.hub.IframeFIMHubClient=function(client,params){var initialMsg=RegExp("[\\?&]oahm=([^&#]*)").exec(window.location.search)
        if(!initialMsg)throw Error(OpenAjax.hub.Error.WrongProtocol)
        initialMsg=initialMsg[1]
        var partnerProtocolID=initialMsg.split(":",1)
        if(partnerProtocolID[0]!=smash._protocolID)throw Error(OpenAjax.hub.Error.WrongProtocol)
        initialMsg=initialMsg.substring(partnerProtocolID[0].length+1)
        var url=window.location.href+"#"+initialMsg
        window.location.replace(url),this._client=client,this._onSecurityAlert=params.HubClient.onSecurityAlert,this._scope=params.HubClient.scope||window
        var re=RegExp("\\d{3}.{"+smash._securityTokenLength+"}.{"+smash._securityTokenLength+"}\\d{3}(.*)"),payload=re.exec(initialMsg)[1],parts=payload.split(":"),internalID=decodeURIComponent(parts[0])
        if(this._id=internalID.substring(internalID.indexOf("_")+1),parts[2]&&"debug"==parts[2]&&(OpenAjax.hub.enableDebug=!0),params.HubClient.log){var id=this._id,scope=this._scope,logfunc=params.HubClient.log
            this._log=function(msg){logfunc.call(scope,"IframeHubClient::"+id+": "+msg)},this._doLog=!0}else this._log=function(){}
        this._connected=!1,this._subs={},this._subIndex=1,smash._createPRNG(this,params)},OpenAjax.hub.IframeFIMHubClient.prototype.connect=function(onComplete,scope){function cb(success){if(success&&(that._connected=!0),onComplete)try{onComplete.call(scope,that._client,success)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onComplete callback to HubClient.connect(): "+e.message)}}if(null==smash._singletonClientHub){smash._singletonClientHub=new smash.SEHubClient(null,this._log)
        var that=this
        smash._singletonClientHub.setSecurityErrorCallback(function(errorcode){errorcode!=smash.SecurityErrors.INVALID_TOKEN&&that._log("unknown smash security error: "+errorcode)
            try{that._onSecurityAlert.call(that._scope,that._client,OpenAjax.hub.SecurityAlert.ForgedMsg)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onSecurityAlert callback to constructor: "+e.message)}})}var that=this
        smash._singletonClientHub.connect(cb)},OpenAjax.hub.IframeFIMHubClient.prototype.disconnect=function(onComplete,scope){function cb(success){if(onComplete)try{onComplete.call(scope,that._client,success)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onComplete callback to HubClient.disconnect(): "+e.message)}}this._connected=!1
        var that=this
        smash._singletonClientHub.disconnect(cb)},OpenAjax.hub.IframeFIMHubClient.prototype.getPartnerOrigin=function(){return smash._singletonClientHub?smash._singletonClientHub.getPartnerOrigin():null},OpenAjax.hub.IframeFIMHubClient.prototype.getClientID=function(){return this._id},OpenAjax.hub.IframeFIMHubClient.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){function dataCallback(subHandle,topic,data){try{onData.call(scope,topic,data,subscriberData)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onData callback to HubClient.subscribe(): "+e.message)}}var subID=""+this._subIndex++,that=this,completeCallback=onComplete?function(success,subHandle,error){try{onComplete.call(scope,subID,success,error)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onComplete callback to HubClient.subscribe(): "+e.message)}}:null
        return this._subs[subID]=smash._singletonClientHub.subscribe(topic,completeCallback,dataCallback,scope,subscriberData),subID},OpenAjax.hub.IframeFIMHubClient.prototype.publish=function(topic,data){smash._singletonClientHub.publish(topic,data)},OpenAjax.hub.IframeFIMHubClient.prototype.unsubscribe=function(subID,onComplete,scope){function cb(success){if(delete that._subs[subID],onComplete)try{onComplete.call(scope,subID,success)}catch(e){OpenAjax.hub._debugger(),that._log("caught error from onComplete callback to HubClient.unsubscribe(): "+e.message)}}if(!this._subs[subID])throw Error(OpenAjax.hub.Error.NoSubscription)
        var that=this
        this._subs[subID].unsubscribe(cb)},OpenAjax.hub.IframeFIMHubClient.prototype.isConnected=function(){return this._connected},OpenAjax.hub.IframeFIMHubClient.prototype.getScope=function(){return this._scope},OpenAjax.hub.IframeFIMHubClient.prototype.getSubscriberData=function(subID){var sub=this._subs[subID]
        if(sub)return sub.getSubscriberData()
        throw Error(OpenAjax.hub.Error.NoSubscription)},OpenAjax.hub.IframeFIMHubClient.prototype.getSubscriberScope=function(subID){var sub=this._subs[subID]
        if(sub)return sub.getSubscriberScope()
        throw Error(OpenAjax.hub.Error.NoSubscription)},void 0===smash)var smash={}
    if(smash._singletonManager=void 0,smash._singletonClientHub=void 0,smash._protocolID="openajax-2.0",smash._prng=void 0,smash._securityTokenLength=6,smash._securityTokenOverhead=null,smash._computeOtherTokenConstants=function(){smash._securityTokenOverhead=2*smash._securityTokenLength,smash._multiplier=Math.pow(10,smash._securityTokenLength-1)},smash._computeOtherTokenConstants(),smash._createPRNG=function(container,params){if(!smash._prng){var seed=(new Date).getTime()+Math.random()+document.cookie
        smash._prng=smash.crypto.newPRNG(seed)}var p=params.IframeContainer||params.IframeHubClient
        if(p&&p.seed)try{var extraSeed=p.seed.call(container._scope)
            smash._prng.addSeed(extraSeed)}catch(e){OpenAjax.hub._debugger(),container._log("caught error from 'seed' callback: "+e.message)}},smash._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",smash._generateSecurityToken=function(){var r
        if(smash._prng)r=smash._prng.nextRandomB64Str(smash._securityTokenLength)
        else{var r1=Math.random()
            r=""
            for(var i=0;i<smash._securityTokenLength;i++){var r2=64*r1,c=Math.floor(r2)
                r1=r2-c,r+=smash._keyStr.charAt(c)}}return r},smash._ensureSingletonManager=function(){null==smash._singletonManager&&(smash._singletonManager=new smash.SEHub)},smash.SEHub=function(){function ComponentInfo(uri,eCallback){this.uri=uri,this.connected=!1,this.errorCallback=eCallback}function securityListener(errorType,clientName){var ci=that.componentInfo[clientName]
        if(null!=ci){var errorCallback=ci.errorCallback
            null!=errorCallback&&errorCallback(clientName,errorType)}}var that=this
        this.componentInfo=[],this._subs=[],this.generateUniqueClientName=function(clientName){do clientName=(0|32767*Math.random()).toString(16)+"_"+clientName
        while(that.componentInfo[clientName])
            return clientName},this.prepareForLoad=function(params){var clientName=params.clientName,componentURI=params.uri
            return null==clientName||null==componentURI?null:null!=that.componentInfo[clientName]?null:(that.componentInfo[clientName]=new ComponentInfo(componentURI,params.commErrorCallback),that.componentInfo[clientName].seComm=new smash.SEComm,that.componentInfo[clientName].seComm.setSecurityListener(securityListener),that.componentInfo[clientName].oaaContainer=params.oaaContainer,that.componentInfo[clientName].seComm.prepareForLoad(clientName,componentURI,that,smash._loadTimeout,params.log))},this.prepareForUnload=function(clientName){return that.componentInfo[clientName]?(that._disconnect(clientName),that.componentInfo[clientName].seComm.prepareForUnload(),delete that.componentInfo[clientName],!0):!0},this.isConnected=function(clientName){return that.componentInfo[clientName]&&that.componentInfo[clientName].connected?!0:!1},this.sendToClient=function(clientName,topic,data,matchingSubs){if(that.isConnected(clientName)){var comms=that.componentInfo[clientName].seComm
            comms&&comms.distribute(topic,matchingSubs,data)}},this.componentLoaded=function(clientName,partnerURL){if(that.componentInfo[clientName]){that.componentInfo[clientName].connected=!0,that.componentInfo[clientName].partnerOrigin=RegExp("^([a-zA-Z]+://[^:/?#]+).*").exec(partnerURL)[1]
            var oaaContainer=that.componentInfo[clientName].oaaContainer
            if(oaaContainer._container.getIframe().style.visibility="visible",oaaContainer._onConnect)try{oaaContainer._onConnect.call(oaaContainer._scope,oaaContainer._container)}catch(e){OpenAjax.hub._debugger(),oaaContainer._log("caught error from onConnect callback to constructor: "+e.message)}}},this.publishInternal=function(componentId,topic,message){if(that.componentInfo[componentId]){var oaaContainer=that.componentInfo[componentId].oaaContainer
            oaaContainer._hub.publishForClient(oaaContainer._container,topic,message)}},this.subscribeInternal=function(componentId,subId,topic){var oaaContainer=that.componentInfo[componentId].oaaContainer
            that._subs[subId]=oaaContainer._hub.subscribeForClient(oaaContainer._container,topic,subId)},this.unsubscribeInternal=function(componentId,subId){try{var handle=that._subs[subId],oaaContainer=that.componentInfo[componentId].oaaContainer
            return oaaContainer._hub.unsubscribeForClient(oaaContainer._container,handle),!0}catch(e){}return!1},this.disconnect=function(componentId){that._disconnect(componentId)
            var oaaContainer=that.componentInfo[componentId].oaaContainer
            if(oaaContainer._onDisconnect)try{oaaContainer._onDisconnect.call(oaaContainer._scope,oaaContainer._container)}catch(e){OpenAjax.hub._debugger(),oaaContainer._log("caught error from onDisconnect callback to constructor: "+e.message)}},this._disconnect=function(componentId){if(that.componentInfo[componentId].connected){that.componentInfo[componentId].connected=!1
            var oaaContainer=that.componentInfo[componentId].oaaContainer
            oaaContainer._container.getIframe().style.visibility="hidden"
            for(var sub in that._subs)oaaContainer._hub.unsubscribeForClient(oaaContainer._container,that._subs[sub])
            that._subs=[]}},this.getPartnerOrigin=function(componentId){return that.componentInfo[componentId].connected?that.componentInfo[componentId].partnerOrigin:null}},smash.SEHubClient=function(clientName,logfunc){function SubHandle(subId,topic,callback,eventCallback,sehubClient,scope,subscriberData){var _isSubscribed=!1,_data=subscriberData,_scope=scope,that=this
        this.getTopic=function(){return topic},this.getConnHandle=function(){return sehubClient},this.equals=function(anotherSubHandle){return null!=anotherSubHandle._getSubId&&"function"==typeof anotherSubHandle._getSubId&&null!=anotherSubHandle.getConnHandle&&"function"==typeof anotherSubHandle.getConnHandle&&subId===anotherSubHandle._getSubId()&&sehubClient===anotherSubHandle.getConnHandle()?!0:!1},this.isSubscribed=function(){return _isSubscribed},this.unsubscribe=function(callback){return sehubClient._unsubscribe(that,callback)},this.getSubscriberData=function(){return _data},this.getSubscriberScope=function(){return _scope},this._getSubId=function(){return subId},this._setIsSubscribed=function(value){_isSubscribed=value},this._getCallback=function(){return callback},this._getEventCallback=function(){return eventCallback}}function handleIncomingMessage(message){if(connected||message.type==smash.SECommMessage.CONNECT_ACK)switch(message.type){case smash.SECommMessage.DISTRIBUTE:if(null!=message.additionalHeader&&null!=message.additionalHeader.s)for(var subs=message.additionalHeader.s,i=0;i<subs.length;i++){var subId=subs[i]
        if(null!=subId&&null!=subHandles[subId]){var eventCallback=subHandles[subId]._getEventCallback()
            null!=eventCallback&&eventCallback(subHandles[subId],message.topic,message.payload)}}break
        case smash.SECommMessage.SUBSCRIBE_ACK:if(null!=message.additionalHeader){var subId=message.additionalHeader.subId,isOk=message.additionalHeader.isOk,err=message.additionalHeader.err
            if(null!=subId&&null!=isOk&&null!=subHandles[subId]){var callback=subHandles[subId]._getCallback()
                isOk?(subHandles[subId]._setIsSubscribed(!0),null!=callback&&callback(!0,subHandles[subId])):(null!=callback&&callback(!1,subHandles[subId],err),subHandles[subId]=void 0)}}break
        case smash.SECommMessage.CONNECT_ACK:connectCallback(!0)
            break
        case smash.SECommMessage.DISCONNECT_ACK:disconnectCallback(!0)}}function securityListenerCallback(errorcode){if(null==securityErrorCallback)throw Error(errorString)
        securityErrorCallback(errorcode)}this.equals=function(anotherConn){return that===anotherConn},this.isConnected=function(){return connected},this.getClientName=function(){return clientName},this.connect=function(callback){connectCallback=function(success){success&&(connected=!0),callback(success,that)},seCommClient.connect(connectCallback)},this.disconnect=function(callback){disconnectCallback=function(success){success&&(connected=!1,subHandles=[]),callback(success,that)},seCommClient.disconnect()},this.subscribe=function(topic,callback,eventCallback,scope,subscriberData){var subId=subCount+""
        return subCount++,subHandles[subId]=new SubHandle(subId,topic,callback,eventCallback,that,scope,subscriberData),seCommClient.subscribe(subId,topic),subHandles[subId]},this.publish=function(topic,data){return seCommClient.publish(topic,data),!0},this.getPartnerOrigin=function(){if(connected&&null!=seCommClient){var ptu=seCommClient.getParsedTunnelUrl()
        if(null!=ptu)return ptu.scheme+"://"+ptu.host}return null},this.setSecurityErrorCallback=function(errorcallback){securityErrorCallback=errorcallback},this._unsubscribe=function(subHandle,callback){var subId=subHandle._getSubId()
        if(!subHandles[subId])throw Error(OpenAjax.hub.Error.NoSubscription)
        return subHandles[subId]=void 0,seCommClient.unsubscribe(subId),null!=callback&&callback(!0,subHandle),subHandle}
        var securityErrorCallback=void 0,subCount=0,subHandles=[],seCommClient=new smash.SECommClient(clientName,logfunc),connected=!1,that=this,connectCallback=null,disconnectCallback=null
        seCommClient.handleIncomingMessage=handleIncomingMessage,seCommClient.setSecurityListener(securityListenerCallback)},smash.SecurityErrors={INVALID_TOKEN:0,TOKEN_VERIFICATION_FAILED:1,TUNNEL_UNLOAD:2,COMPONENT_LOAD:3},smash.SECommMessage=function(){this.type=null,this.topic=null,this.additionalHeader=null,this.payload=null
        var typeName="y",topicName="t",additionalHeaderName="h",payloadName="p"
        this.serialize=function(){var returnValue=typeName+"="+this.type
            if(null!=this.topic){var topicString=encodeURIComponent(this.topic),topicSer="&"+topicName+"="+topicString
                returnValue+=topicSer}if(null!=this.additionalHeader){var headerString=encodeURIComponent(JSON.stringify(this.additionalHeader)),headerSer="&"+additionalHeaderName+"="+headerString
                returnValue+=headerSer}if(null!=this.payload){var payloadString=encodeURIComponent(this.payload),payloadSer="&"+payloadName+"="+payloadString
                returnValue+=payloadSer}return returnValue},this.deserialize=function(serializedMessage){for(var messageParts=serializedMessage.split("&"),i=0;i<messageParts.length;i++){var nameValue=messageParts[i].split("=")
            switch(nameValue[0]){case typeName:this.type=nameValue[1]
                break
                case topicName:this.topic=decodeURIComponent(nameValue[1])
                    break
                case additionalHeaderName:var headerString=decodeURIComponent(nameValue[1])
                    this.additionalHeader=JSON.parse(headerString)
                    break
                case payloadName:this.payload=decodeURIComponent(nameValue[1])}}}},smash.SECommMessage.CONNECT="con",smash.SECommMessage.CONNECT_ACK="cac",smash.SECommMessage.DISCONNECT="xcon",smash.SECommMessage.DISCONNECT_ACK="xac",smash.SECommMessage.PUBLISH="pub",smash.SECommMessage.DISTRIBUTE="dis",smash.SECommMessage.SUBSCRIBE="sub",smash.SECommMessage.UNSUBSCRIBE="uns",smash.SECommMessage.SUBSCRIBE_ACK="sac",smash.SECommMessage.ERROR="err",smash.SECommErrors={},smash.SECommErrors.tunnelNotSetError=Error("The tunnel URI was not set. Please set the tunnel URI."),smash.SEComm=function(){function insertURLParams(uri,params){var parts=uri.split("?")
        return parts.length>1?parts[0]+"?"+params+"&"+parts[1]:(parts=uri.split("#"),parts.length>1?parts[0]+"?"+params+parts[1]:uri+"?"+params)}function pollForIncomingCommLibTimeout(){clearInterval(registrationTimerProcess),registrationTimerProcess=null,commLib||that.handleSecurityError(smash.SecurityErrors.COMPONENT_LOAD)}function reconnectTimeout(){clearInterval(reconnectTimerProcess),that.handleSecurityError(smash.SecurityErrors.COMPONENT_LOAD)}function securityListenerClosure(error,componentId){return function(){securityListener(error,componentId)}}function tunnelUnloadHandler(){null==securityListener?setTimeout("throw tunnelUnloadError;",unloadTimer):setTimeout(securityListenerClosure(smash.SecurityErrors.TUNNEL_UNLOAD,componentID),unloadTimer)}function send(message){0==initialized?queueOut.push(message):commLib.send(message)}var unloadTimer=1,registrationTimerProcess=null,loadTimeout=0,reconnectTimerProcess=null,componentURI=null,commLib=null,componentID=null,queueOut=[],seHUB=null,securityTokenParent=null,securityListener=null,that=this,initialized=!1,logfunc=null
        this.setSecurityListener=function(callback){securityListener=callback},this.prepareForLoad=function(componentId,frameURI,seHub,loadtimeout,logFunc){if(logfunc=logFunc,this.log("Parent connecting to : "+componentId),seHUB=seHub,componentID=componentId,loadTimeout=loadtimeout,null==smash.SEComm.tunnelURI)throw smash.SECommErrors.tunnelNotSetError
            return securityTokenParent=smash._generateSecurityToken(),componentURI=insertURLParams(frameURI,"oahm="+smash._protocolID+":100"+securityTokenParent+securityTokenParent+"000"+encodeURIComponent(componentId)+":"+encodeURIComponent(smash.SEComm.tunnelURI)),smash.SEComm.instances[componentId]=that,registrationTimerProcess=setInterval(pollForIncomingCommLibTimeout,loadTimeout),componentURI},this.getScope=function(){return this},this.getCallback=function(){return"messageReceived"},this.initializationFinished=function(tunnelCommLib,token,currentClientURI,initialClientURI,tunnelWindow){if(this.log("Tunnel commLib initialization finished. Processing outgoing queue. Security token: "+token),securityTokenParent!=token)return that.handleSecurityError(smash.SecurityErrors.TOKEN_VERIFICATION_FAILED),!1
            for(commLib=tunnelCommLib,initialized=!0,this.log("Token verified."),tunnelWindow.onunload=tunnelUnloadHandler,seHUB.componentLoaded(componentID,currentClientURI);queueOut.length>0;)commLib.send(queueOut.shift())
            return!0},this.prepareForUnload=function(){null!=registrationTimerProcess&&(clearInterval(registrationTimerProcess),registrationTimerProcess=null)},this.handleSecurityError=function(error){if(error==smash.SecurityErrors.COMPONENT_LOAD&&(this.initializationFinished=function(){return!1}),null==securityListener)throw Error(error)
            securityListener(error,componentID)},this.messageReceived=function(message){var msg=new smash.SECommMessage
            switch(msg.deserialize(message),msg.type){case smash.SECommMessage.PUBLISH:if(null!=msg.additionalHeader){var payload=msg.payload
                "J"==msg.additionalHeader.f&&(payload=JSON.parse(msg.payload)),seHUB.publishInternal(componentID,msg.topic,payload)}break
                case smash.SECommMessage.SUBSCRIBE:if(null!=msg.additionalHeader){var isOk=!0,errMsg=""
                    try{seHUB.subscribeInternal(componentID,msg.additionalHeader.subId,msg.topic)}catch(e){isOk=!1,errMsg=e.message}var msgack=new smash.SECommMessage
                    msgack.type=smash.SECommMessage.SUBSCRIBE_ACK,msgack.additionalHeader={subId:msg.additionalHeader.subId,isOk:isOk,err:errMsg},send(msgack.serialize())}break
                case smash.SECommMessage.UNSUBSCRIBE:null!=msg.additionalHeader&&seHUB.unsubscribeInternal(componentID,msg.additionalHeader.subId)
                    break
                case smash.SECommMessage.CONNECT:clearInterval(reconnectTimerProcess),seHUB.componentLoaded(componentID,msg.payload)
                    var msg=new smash.SECommMessage
                    msg.type=smash.SECommMessage.CONNECT_ACK,send(msg.serialize())
                    break
                case smash.SECommMessage.DISCONNECT:seHUB.disconnect(componentID),reconnectTimerProcess=setInterval(reconnectTimeout,loadTimeout)
                    var msg=new smash.SECommMessage
                    msg.type=smash.SECommMessage.DISCONNECT_ACK,send(msg.serialize())}},this.distribute=function(topic,matchingSubs,payload){var msg=new smash.SECommMessage
            msg.type=smash.SECommMessage.DISTRIBUTE,msg.topic=topic,msg.additionalHeader={s:matchingSubs},"string"==typeof payload?(msg.additionalHeader.f="S",msg.payload=payload):(msg.additionalHeader.f="J",msg.payload=JSON.stringify(payload)),send(msg.serialize())},this.log=function(msg){logfunc(msg)}},smash.SEComm.instances=[],smash.SECommClient=function(clientName,logfunc){function ParsedUrl(url){var matchedurl=url.match(_regex)
        this.scheme=""==matchedurl[2]?null:matchedurl[2],this.host=""==matchedurl[4]?null:matchedurl[4],this.port=""==matchedurl[6]?null:matchedurl[6],this.path=""==matchedurl[7]?null:matchedurl[7],this.query=""==matchedurl[8]?null:matchedurl[8]}function send(message){0==initialized?queueOut.push(message):commLib.send(message)}var controllers=[]
        controllers.child=this
        var commLib=new smash.CommLib(!0,controllers,clientName),that=this,queueOut=[],initialized=!1,securityListener=null,jsonPayloadHeader={f:"J"},stringPayloadHeader={f:"S"},parsedTunnelUrl=null
        this.publish=function(topic,data){var msg=new smash.SECommMessage
            msg.type=smash.SECommMessage.PUBLISH,msg.topic=topic,"string"==typeof data?(msg.additionalHeader=stringPayloadHeader,msg.payload=data):(msg.additionalHeader=jsonPayloadHeader,msg.payload=JSON.stringify(data)),send(msg.serialize())},this.subscribe=function(subId,topic){var msg=new smash.SECommMessage
            msg.type=smash.SECommMessage.SUBSCRIBE,msg.topic=topic,msg.additionalHeader={subId:subId},send(msg.serialize())},this.connect=function(callback){if(initialized){var msg=new smash.SECommMessage
            return msg.type=smash.SECommMessage.CONNECT,msg.payload=window.location.href.split("#")[0],send(msg.serialize()),void 0}connectCallback=callback},this.disconnect=function(){var msg=new smash.SECommMessage
            msg.type=smash.SECommMessage.DISCONNECT,send(msg.serialize())},this.initializationFinished=function(tunnelUrl){for(this.log("Initialization finished. Processing outgoing queue."),parsedTunnelUrl=new ParsedUrl(tunnelUrl),initialized=!0,connectCallback(!0);queueOut.length>0;)commLib.send(queueOut.shift())},this.getParsedTunnelUrl=function(){return parsedTunnelUrl}
        var _regex=RegExp("^((http|https):)?(//([^/?#:]*))?(:([0-9]*))?([^?#]*)(\\?([^#]*))?")
        this.unsubscribe=function(subId){var msg=new smash.SECommMessage
            msg.type=smash.SECommMessage.UNSUBSCRIBE,msg.additionalHeader={subId:subId},send(msg.serialize())},this.messageReceived=function(message){var msg=new smash.SECommMessage
            if(msg.deserialize(message),msg.type==smash.SECommMessage.DISTRIBUTE){var header=msg.additionalHeader
                null!=header&&"J"==header.f&&(msg.payload=JSON.parse(msg.payload))}that.handleIncomingMessage(msg)},this.handleSecurityError=function(error){if(null==securityListener)throw Error(error)
            securityListener(error,clientName)},this.setSecurityListener=function(callback){securityListener=callback},this.handleIncomingMessage=function(message){alert("SECommClient\n\nTopic: "+message.topic+"\n\nPayload: "+message.payload)},this.log=function(msg){logfunc(msg)}},smash.CommLib=function(child,controllers,clientName){function messageTimer(){checkMessage()&&decodeMessage()&&checkSecurity()&&processMessage(),checkAck()&&sendMessage()}function checkAck(){return previousOut.type==ACK?!0:previousOut.msn==messageIn.ackMsn&&1==messageIn.ack?!0:(log("Waiting for ACK : "+previousOut.msn),!1)}function getNewMsn(){return msn++,100==msn&&(msn=0),10>msn?"0"+msn:""+msn}function checkMessage(){var urlParts=window.location.href.split("#")
        if(2==urlParts.length){var newHash=urlParts[1]
            if(""!=newHash&&newHash!=currentHash)return currentHash=newHash,!0}return!1}function decodeMessage(){var type=currentHash.substr(0,1),msn=currentHash.substr(1,2),nextStart=3,tokenParent=currentHash.substr(nextStart,smash._securityTokenLength)
        nextStart+=smash._securityTokenLength
        var tokenChild=currentHash.substr(nextStart,smash._securityTokenLength)
        nextStart+=smash._securityTokenLength
        var ack=currentHash.substr(nextStart,1)
        nextStart+=1
        var ackMsn=currentHash.substr(nextStart,2)
        nextStart+=2
        var payload=currentHash.substr(nextStart)
        return log("In : Type: "+type+" msn: "+msn+" tokenParent: "+tokenParent+" tokenChild: "+tokenChild+" ack: "+ack+" msn: "+ackMsn+" payload: "+payload),messageIn={type:type,msn:msn,tokenParent:tokenParent,tokenChild:tokenChild,ack:ack,ackMsn:ackMsn,payload:payload},!0}function checkSecurity(){return messageIn.type==INIT||messageIn.tokenParent==securityTokenParent&&messageIn.tokenChild==securityTokenChild?!0:(log("Security token error: Invalid security token received. The message will be discarded."),handleSecurityError(smash.SecurityErrors.INVALID_TOKEN),!1)}function processMessage(){switch(ack=1,messageIn.type!=INIT&&child&&previousOut.type==INIT&&"1"==messageIn.ack&&previousOut.msn==messageIn.ackMsn&&controller.initializationFinished(partnerURL),messageIn.type){case INIT:processInit()
        break
        case ACK:processAck()
            break
        case PART:processPart()
            break
        case END:processEnd()}previousIn=messageIn}function processInit(){var parts=messageIn.payload.split(":"),cname=decodeURIComponent(parts[0])
        if(partnerURL=decodeURIComponent(parts[1]),securityTokenParent=messageIn.tokenParent,securityTokenChild=messageIn.tokenChild,child){null!=clientName&&(cname=clientName),securityTokenChild=smash._generateSecurityToken()
            var tunnelGUID="3827816c-f3b1-11db-8314-0800200c9a66",iframe=document.createElement("iframe"),currentClientURI=encodeURIComponent(window.location.href.split("#")[0]),initialClientURI=currentClientURI,initpayload=encodeURIComponent(cname)+":"+currentClientURI+":"+initialClientURI
            partnerURL+=(-1!=partnerURL.indexOf("?")?"&":"?")+"oahm=100"+securityTokenParent+securityTokenChild+"100"+initpayload,iframe.src=partnerURL,iframe.name=tunnelGUID,iframe.id=tunnelGUID,document.body.appendChild(iframe),iframe.style.position="absolute",iframe.style.left=iframe.style.top="-10px",iframe.style.height=iframe.style.width="1px",iframe.style.visibility="hidden",ack=0,partnerWindow=window.frames[tunnelGUID],previousOut={type:INIT,msn:"00",tokenParent:securityTokenParent,tokenChild:securityTokenChild,ack:"0",ackMsn:"00",payload:initpayload},controller=controllers.child}else{var initialClientURI=decodeURIComponent(parts[2])
            partnerWindow=window.parent,controller=controllers[cname]
            var success=controller.initializationFinished(that,securityTokenParent,partnerURL,initialClientURI,window)
            success||(ack=0),previousOut={type:INIT,msn:"00",tokenParent:securityTokenParent,tokenChild:securityTokenChild,ack:"0",ackMsn:"00",payload:encodeURIComponent(cname)+":"+encodeURIComponent(window.location.href.split("#")[0])}}null==partnerWindow&&log("Init failed.")}function processAck(){ack=0}function processPart(){messageBuffer+=messageIn.payload}function processEnd(){messageBuffer+=messageIn.payload,log("Received: "+messageBuffer),controller.messageReceived(messageBuffer),messageBuffer=""}function sendMessage(){0==queueOut.length&&1==ack&&queueOut.push({type:ACK,payload:""}),0!=queueOut.length&&(messageOut=queueOut.shift(),messageOut.tokenParent=securityTokenParent,messageOut.tokenChild=securityTokenChild,messageOut.msn=getNewMsn(),messageOut.ack="1",messageOut.ackMsn=previousIn.msn,ack=0,writeToPartnerWindow())}function writeToPartnerWindow(){var url=partnerURL+"#"+messageOut.type+messageOut.msn+messageOut.tokenParent+messageOut.tokenChild+messageOut.ack+messageOut.ackMsn+messageOut.payload
        partnerWindow.location.replace(url),previousOut=messageOut,log("Out: Type: "+messageOut.type+" msn: "+messageOut.msn+" tokenParent: "+messageOut.tokenParent+" tokenChild: "+messageOut.tokenChild+" ack: "+messageOut.ack+" msn: "+messageOut.ackMsn+" payload: "+messageOut.payload)}function handleSecurityError(error){clearInterval(timerId),controller.handleSecurityError(error)}function log(msg){if(controller){for(;logQ.length>0;)controller.log(logQ.shift())
        controller.log(msg)}else logQ.push(msg)}var INIT="1",ACK="2",PART="3",END="4",that=this,interval=100,urlLimit=4e3,protocolOverhead=6,ack=0,currentHash=null,messageIn=null,previousIn=null,messageOut=null,previousOut=null,partnerURL=null,partnerWindow=null,queueOut=[],msn=0,messageBuffer="",timerId=null,securityTokenParent=null,securityTokenChild=null,controller=null,logQ=[]
        this.send=function(message){if(null==partnerURL)return log("Trying to send without proper initialization. Message will be discarded. "+message),void 0
            log("Sending: "+message)
            for(var encodedMessage=message,payloadLength=urlLimit-protocolOverhead-smash._securityTokenOverhead-partnerURL.length,currentMessage=encodedMessage;currentMessage.length>0;){var part=currentMessage.substr(0,payloadLength)
                currentMessage=currentMessage.substr(payloadLength),0==currentMessage?queueOut.push({type:END,payload:part}):queueOut.push({type:PART,payload:part})}},timerId=setInterval(messageTimer,interval)},void 0===smash)var smash={}
    return smash.crypto={strToWA:function(str,chrsz){for(var bin=[],mask=(1<<chrsz)-1,i=0;i<str.length*chrsz;i+=chrsz)bin[i>>5]|=(str.charCodeAt(i/chrsz)&mask)<<32-chrsz-i%32
        return bin},hmac_sha1:function(keyWA,dataS,chrsz){for(var ipad=Array(16),opad=Array(16),i=0;16>i;i++)ipad[i]=909522486^keyWA[i],opad[i]=1549556828^keyWA[i]
        var hash=this.sha1(ipad.concat(this.strToWA(dataS,chrsz)),512+dataS.length*chrsz)
        return this.sha1(opad.concat(hash),672)},newPRNG:function(seedS){function extract(seedS){return that.hmac_sha1(__refresh_keyWA,seedS,8)}function refresh(seedS){for(var uniformSeedWA=extract(seedS),i=0;5>i;i++)_keyWA[i]^=uniformSeedWA[i]}that=this,("string"!=typeof seedS||seedS.length<12)&&alert("WARNING: Seed length too short ...")
        var __refresh_keyWA=[43417,15926,18182,33130,9585,30800,49772,40144,47678,55453,4659,38181,65340,6787,54417,65301],_keyWA=[],_cnt=0
        return refresh(seedS),{addSeed:function(seed){refresh(seed)},nextRandomOctets:function(len){for(var randOctets=[];len>0;){_cnt+=1
            var nextBlock=that.hmac_sha1(_keyWA,_cnt.toString(16),8)
            for(i=0;20>i&len>0;i++,len--)randOctets.push((nextBlock[i>>2]>>i%4)%256)}return randOctets},nextRandomB64Str:function(len){for(var b64StrMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",randOctets=this.nextRandomOctets(len),randB64Str="",i=0;len>i;i++)randB64Str+=b64StrMap.charAt(63&randOctets[i])
            return randB64Str}}},sha1:function(){function sha1_ft(t,b,c,d){return 20>t?b&c|~b&d:40>t?b^c^d:60>t?b&c|b&d|c&d:b^c^d}function sha1_kt(t){return 20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514}var add_wa=function(x,y){var lsw=(65535&x)+(65535&y),msw=(x>>16)+(y>>16)+(lsw>>16)
        return msw<<16|65535&lsw},rol=function(num,cnt){return num<<cnt|num>>>32-cnt}
        return function(dataWA,lenInBits){dataWA[lenInBits>>5]|=128<<24-lenInBits%32,dataWA[(lenInBits+64>>9<<4)+15]=lenInBits
            for(var W=Array(80),H0=1732584193,H1=-271733879,H2=-1732584194,H3=271733878,H4=-1009589776,i=0;i<dataWA.length;i+=16){for(var a=H0,b=H1,c=H2,d=H3,e=H4,j=0;80>j;j++){W[j]=16>j?dataWA[i+j]:rol(W[j-3]^W[j-8]^W[j-14]^W[j-16],1)
                var T=add_wa(add_wa(rol(a,5),sha1_ft(j,b,c,d)),add_wa(add_wa(e,W[j]),sha1_kt(j)))
                e=d,d=c,c=rol(b,30),b=a,a=T}H0=add_wa(a,H0),H1=add_wa(b,H1),H2=add_wa(c,H2),H3=add_wa(d,H3),H4=add_wa(e,H4)}return[H0,H1,H2,H3,H4]}}()},this.JSON||(JSON={}),function(){function f(n){return 10>n?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a]
        return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key]
        switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value)
            case"number":return isFinite(value)?value+"":"null"
            case"boolean":case"null":return value+""
            case"object":if(!value)return"null"
                if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1)partial[i]=str(i,value)||"null"
                    return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;length>i;i+=1)k=rep[i],"string"==typeof k&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))
            else for(k in value)Object.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))
                return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()})
        var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep
        "function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i
            if(gap="",indent="","number"==typeof space)for(i=0;space>i;i+=1)indent+=" "
            else"string"==typeof space&&(indent=space)
            if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw Error("JSON.stringify")
            return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key]
            if(value&&"object"==typeof value)for(k in value)Object.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k])
            return reviver.call(holder,key,value)}var j
            if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j
            throw new SyntaxError("JSON.parse")})}(),window.PageBus||(window.PageBus={}),PageBus._debug=function(){},PageBus._esc=function(s){return s.replace(/\./g,"!")},PageBus._assertPubTopic=function(topic){if(null==topic||""==topic||-1!=topic.indexOf("*")||-1!=topic.indexOf("..")||"."==topic.charAt(0)||"."==topic.charAt(topic.length-1))throw Error(OpenAjax.hub.Error.BadParameters)},PageBus._assertSubTopic=function(topic){if(null==topic||""==topic)throw Error(OpenAjax.hub.Error.BadParameters)
        for(var path=topic.split("."),len=path.length,i=0;len>i;i++){var p=path[i]
            if(""==p||-1!=p.indexOf("*")&&"*"!=p&&"**"!=p)throw Error(OpenAjax.hub.Error.BadParameters)
            if("**"==p&&len-1>i)throw Error(OpenAjax.hub.Error.BadParameters)}},PageBus._copy=function(obj){var c
        if("object"==typeof obj){if(null==obj)return null
            if(obj.constructor==Array){c=[]
                for(var i=0;i<obj.length;i++)c[i]=PageBus._copy(obj[i])
                return c}if(obj.constructor==Date)return c=new Date,c.setDate(obj.getDate()),c
            c={}
            for(var p in obj)c[p]=PageBus._copy(obj[p])
            return c}return obj},PageBus._TopicMatcher=function(){this._items={}},PageBus._TopicMatcher.prototype.store=function(topic,val){var path=topic.split("."),len=path.length
        _recurse=function(tree,index){if(index==len)tree["."]={topic:topic,value:val}
        else{var token=path[index]
            tree[token]||(tree[token]={}),_recurse(tree[token],index+1)}},_recurse(this._items,0)},PageBus._TopicMatcher.prototype.match=function(topic,exactMatch){var path=topic.split("."),len=path.length,res=[]
        return _recurse=function(tree,index){if(tree){var node
            if(index==len)node=tree
            else{if(_recurse(tree[path[index]],index+1),exactMatch)return
                "**"!=path[index]&&_recurse(tree["*"],index+1),node=tree["**"]}node&&node["."]&&res.push(node["."])}},_recurse(this._items,0),res},PageBus._TopicMatcher.prototype.exists=function(topic,exactMatch){var path=topic.split("."),len=path.length,res=!1
        return _recurse=function(tree,index){if(tree){var node
            if(index==len)node=tree
            else{if(_recurse(tree[path[index]],index+1),res||exactMatch)return
                if("**"!=path[index]&&(_recurse(tree["*"],index+1),res))return
                node=tree["**"]}node&&node["."]&&(res=!0)}},_recurse(this._items,0),res},PageBus._TopicMatcher.prototype.clear=function(topic){var path=topic.split("."),len=path.length
        _recurse=function(tree,index){if(tree)if(index==len)tree["."]&&delete tree["."]
        else{_recurse(tree[path[index]],index+1)
            for(var x in tree[path[index]])return
            delete tree[path[index]]}},_recurse(this._items,0)},PageBus._TopicMatcher.prototype.wildcardClear=function(topic){var path=topic.split("."),len=path.length
        _clean=function(node,tok){for(m in node[tok])return
            delete node[tok]},_recurse=function(tree,index){if(tree){if(index==len)return tree["."]&&delete tree["."],void 0
            var n,tok=path[index]
            if(tree[tok]&&(_recurse(tree[tok],index+1),_clean(tree,tok)),"*"==tok)for(n in tree)"**"!=n&&"."!=n&&(_recurse(tree[n],index+1),_clean(tree,n))
            else if("**"==tok)for(n in tree)delete tree[n]}},_recurse(this._items,0)},PageBus._TopicMatcher.prototype.wildcardMatch=function(topic){var path=topic.split("."),len=path.length,res=[]
        return _recurse=function(tree,index){var node,tok=path[index]
            if(tree&&index!=len)if("**"==tok)for(var n in tree)"."!=n&&(node=tree[n],node["."]&&res.push(node["."]),_recurse(node,index))
            else if("*"==tok)for(var n in tree)"."!=n&&"**"!=n&&(node=tree[n],index==len-1?node["."]&&res.push(node["."]):_recurse(node,index+1))
            else{if(node=tree[tok],!node)return
                index==len-1?node["."]&&res.push(node["."]):_recurse(node,index+1)}},_recurse(this._items,0),res},PageBus.policy={Ops:{Publish:"p",Subscribe:"s"},Error:{BadParameters:"PageBus.policy.Error.BadParameters"},_assertName:function(topic){if(null==topic||""==topic)throw Error(OpenAjax.hub.Error.BadParameters)
        if(!PageBus.policy._tops[topic]){for(var path=topic.split("."),len=path.length,i=0;len>i;i++){var p=path[i]
            if(""==p||-1!=p.indexOf("*")&&"*"!=p&&"**"!=p)throw Error(PageBus.policy.Error.BadParameters)
            if("**"==p&&len-1>i)throw Error(PageBus.policy.Error.BadParameters)}PageBus.policy._tops[topic]=!0}},_tops:{}},PageBus.policy.HubPolicy=function(params){params||(params={}),this._cfg=params,this._log=params.log,this._topicMgr=new PageBus._TopicMatcher},PageBus.policy.HubPolicy.prototype.onPublish=function(topic,data,pc,sc){var origin,res=!0
        if(null!=sc){if(origin=sc.getPartnerOrigin(),!origin)return!1
            res=this.isAllowed.call(this,origin,PageBus.policy.Ops.Subscribe,topic)}if(res&&null!=pc){if(origin=pc.getPartnerOrigin(),!origin)return!1
            res=this.isAllowed.call(this,origin,PageBus.policy.Ops.Publish,topic)}if(this._log){var sid=sc?sc.getClientID():"(Mgr)",pid=pc?pc.getClientID():"(Mgr)"
            this._log("(PageBus.policy) ["+pid+", "+sid+"] onPublish: "+(res?"ALLOWED ":"DENIED  ")+topic)}return res},PageBus.policy.HubPolicy.prototype.onSubscribe=function(topic,sc){var origin,res=!0
        if(null!=sc){if(origin=sc.getPartnerOrigin(),!origin)return!1
            res=this.isAllowed.call(this,origin,PageBus.policy.Ops.Subscribe,topic)}if(this._log){var cid=sc?sc.getClientID():"(Mgr)"
            this._log("(PageBus.policy) ["+cid+"] onSubscribe: "+(res?"ALLOWED ":"DENIED  ")+topic)}return res},PageBus.policy.HubPolicy.prototype.onUnsubscribe=function(){},PageBus.policy.HubPolicy.prototype.onSend=function(topic,data,origin){var res=this.isAllowed(origin,PageBus.policy.Ops.Subscribe,topic)
        return this._log&&this._log("(PageBus.policy) ["+origin+"] onSend: "+(res?"ALLOWED ":"DENIED  ")+topic),res},PageBus.policy.HubPolicy.prototype.onReceive=function(topic,data,origin){var res=this.isAllowed(origin,PageBus.policy.Ops.Publish,topic)
        return this._log&&this._log("(PageBus.policy) ["+origin+"] onReceive: "+(res?"ALLOWED ":"DENIED  ")+topic),res},PageBus.policy.HubPolicy.prototype._getMyOrigin=function(){var o=window.location.href.match(/[^:]*:\/\/[^:\/\?#]*/)
        return o[0]},PageBus.policy.HubPolicy.prototype.grant=function(origin,op,name){if(!origin||!op||!name)throw Error(PageBus.policy.Error.BadParameters)
        var t=PageBus._esc(origin)+"."+op+"."+name
        PageBus.policy._assertName(t),this._topicMgr.store(t,{dm:origin,op:op,tp:name}),this._log&&this._log("(PageBus.policy) ["+origin+"] grant: "+op+" on "+name)
        var cacheName="_pagebus.cache.s."+name
        this._topicMgr.store(PageBus._esc(origin)+"."+op+"."+cacheName,{dm:origin,op:op,tp:cacheName}),this._log&&this._log("(PageBus.policy) ["+origin+"] implicit grant: "+op+" on "+cacheName)},PageBus.policy.HubPolicy.prototype.revoke=function(origin,op,name){if(!origin||!op||!name)throw Error(PageBus.policy.Error.BadParameters)
        var t=PageBus._esc(origin)+"."+op+"."+name
        PageBus.policy._assertName(t),this._topicMgr.clear(t),this._log&&this._log("(PageBus.policy) ["+origin+"] revoke: "+op+" on "+name)
        var cacheName="_pagebus.cache.s."+name
        this._topicMgr.clear(PageBus._esc(origin)+"."+op+"."+cacheName),this._log&&this._log("(PageBus.policy) ["+origin+"] implicit revoke: "+op+" on "+cacheName)},PageBus.policy.HubPolicy.prototype.revokeAll=function(origin){if(!origin)throw Error(PageBus.policy.Error.BadParameters)
        this._topicMgr.wildcardClear(PageBus._esc(origin)+".**"),this._log&&this._log("(PageBus.policy) ["+origin+"] revokeAll")},PageBus.policy.HubPolicy.prototype.isAllowed=function(origin,op,name){if(!origin||""==origin||!op||""==op||!name||""==name)throw Error(PageBus.policy.Error.BadParameters)
        var t=PageBus._esc(origin)+"."+op+"."+name
        return this._topicMgr.exists(t,!1)},PageBus.policy.HubPolicy.prototype.listAllowed=function(origin,op){if(!origin||!op)throw Error(PageBus.policy.Error.BadParameters)
        var qr=this._topicMgr.wildcardMatch(PageBus._esc(origin)+"."+op+".**"),res=[]
        for(var r in qr)"_pagebus."!=qr[r].value.tp.substring(0,9)&&res.push(qr[r].value.tp)
        return res},PageBus.cache={},PageBus.cache.Error={NoCache:"PageBus.cache.Error.NoCache"},PageBus._cache={},PageBus._cache.isCacheable=function(subData){return subData&&"object"==typeof subData&&subData.PageBus&&subData.PageBus.cache},PageBus._cache.Cache=function(){this._refs={},this._doCache=new PageBus._TopicMatcher,this._caches=new PageBus._TopicMatcher},PageBus._cache.Cache.prototype.add=function(topic,subID){var dc,dca=this._doCache.match(topic,!0)
        dca.length>0?dc=dca[0].value:(dc={rc:0},this._doCache.store(topic,dc)),dc.rc++,this._refs[subID]=topic},PageBus._cache.Cache.prototype.remove=function(subID){var topic=this._refs[subID]
        if(topic){delete this._refs[subID]
            var dca=this._doCache.match(topic,!0)
            if(0!=dca.length&&(dca[0].value.rc--,0==dca[0].value.rc)){this._doCache.clear(topic)
                for(var caches=this._caches.wildcardMatch(topic),i=0;i<caches.length;i++)this._doCache.exists(caches[i].topic,!1)||this._caches.clear(caches[i].topic)}}},PageBus._cache.Cache.prototype.storeCopy=function(topic,value){PageBus._assertPubTopic(topic)
        var copy=PageBus._copy(value)
        this._caches.store(topic,copy)},PageBus._cache.Cache.prototype.clear=function(topic){PageBus._assertPubTopic(topic),this._caches.clear(topic)},PageBus._cache.Cache.prototype.query=function(topic){return PageBus._assertSubTopic(topic),this._caches.wildcardMatch(topic)},PageBus._cache.Cache.prototype.isCaching=function(topic){for(var r in this._refs);return this._doCache.exists(topic,!1)},PageBus._enableMH=function(){var MHClass=OpenAjax.hub.ManagedHub
        OpenAjax.hub.ManagedHub=function(params){if(!params)throw Error(OpenAjax.hub.Error.BadParameters)
            if(!params.onPublish||!params.onSubscribe)throw Error(OpenAjax.hub.Error.BadParameters)
            var defaultPolicy=null
            params.PageBus||(params.PageBus={}),params.PageBus.policy||(params.PageBus.policy=defaultPolicy),params.scope||(params.scope=window),this._pagebus={_params:{},_getActualParameters:function(){return this._pagebus._params},_policy:params.PageBus.policy,_hub:this},this.pagebus={_hub:this}
            var pb=this._pagebus
            pb._cache=new PageBus._cache.Cache,this.pagebus.query=function(topic){return this._hub._pagebus._cache.query(topic)},this.pagebus.store=function(topic,data){this._hub._pagebus._cache.isCaching(topic)&&this._hub.publish(topic,data)},this.pagebus.clear=function(topic){this._hub._pagebus._cache.isCaching(topic)&&this._hub.publish(topic,null)}
            var appScope=params.scope?params.scope:window,params2=this._pagebus._params
            for(var pn in params)params2[pn]=params[pn]
            params2.scope=params.scope?params.scope:window,params2.onPublish=function(topic,data,pcont,scont){try{var pol=params2.PageBus.policy
                if(pol){var res=pol.onPublish.call(pol,topic,data,pcont,scont)
                    if(!res)return!1}return params.onPublish.call(appScope,topic,data,pcont,scont)}catch(e){return!1}},params2.onSubscribe=function(topic,scont){try{var pol=params2.PageBus.policy
                if(pol){var res=pol.onSubscribe.call(pol,topic,scont)
                    if(!res)return!1}return res=params.onSubscribe.call(appScope,topic,scont)}catch(e){return!1}},params2.onUnsubscribe=function(topic,scont){try{var pol=params2.PageBus.policy
                pol&&pol.onUnsubscribe.call(pol,params.scope,topic,scont),params.onUnsubscribe.call(appScope,topic,scont)}catch(e){return}},pb._policy||(pb._policy=null),MHClass.call(this,params2),this.getParameters=function(){return params}},OpenAjax.hub.ManagedHub.prototype=MHClass.prototype
        var p=OpenAjax.hub.ManagedHub.prototype.publish,s=OpenAjax.hub.ManagedHub.prototype.subscribe,u=OpenAjax.hub.ManagedHub.prototype.unsubscribe,p4c=OpenAjax.hub.ManagedHub.prototype.publishForClient,s4c=OpenAjax.hub.ManagedHub.prototype.subscribeForClient,u4c=OpenAjax.hub.ManagedHub.prototype.unsubscribeForClient,gs=OpenAjax.hub.ManagedHub.prototype.getScope
        OpenAjax.hub.ManagedHub.prototype.publish=function(topic,data){PageBus._assertPubTopic(topic),this._pagebus._cache.isCaching(topic)&&(null==data?this._pagebus._cache.clear(topic):this._pagebus._cache.storeCopy(topic,data)),p.call(this,topic,data)},OpenAjax.hub.ManagedHub.prototype.subscribe=function(topic,onData,scope,onComplete,subscriberData){PageBus._assertSubTopic(topic)
            var sid=s.call(this,topic,onData,scope,onComplete,subscriberData)
            if(PageBus._cache.isCacheable(subscriberData)){var cache=this._pagebus._cache
                cache.add(topic,sid)
                for(var vals=cache.query(topic),i=0;i<vals.length;i++)try{onData.call(scope?scope:window,vals[i].topic,vals[i].value,subscriberData)}catch(e){PageBus._debug()}}return sid},OpenAjax.hub.ManagedHub.prototype.unsubscribe=function(subID,onComplete,scope){var cache=this._pagebus._cache
            cache.remove(subID),u.call(this,subID,onComplete,scope)},OpenAjax.hub.ManagedHub.prototype.getScope=function(){return gs.call(this)},OpenAjax.hub.ManagedHub.prototype.publishForClient=function(container,topic,data){PageBus._assertPubTopic(topic),(!this._pagebus._policy||this._pagebus._policy.isAllowed(container.getPartnerOrigin(),PageBus.policy.Ops.Publish,topic))&&this._pagebus._cache.isCaching(topic)&&(null==data?this._pagebus._cache.clear(topic):this._pagebus._cache.storeCopy(topic,data)),p4c.call(this,container,topic,data)},OpenAjax.hub.ManagedHub.prototype.subscribeForClient=function(container,topic,containerSubID){function _sendValues(){for(var i=0;i<vals.length;i++)container.sendToClient(vals[i].topic,vals[i].value,containerSubID)}PageBus._assertSubTopic(topic)
            var mgrSubID=s4c.call(this,container,topic,containerSubID)
            if("_pagebus.cache.s."==topic.substring(0,17)){var t=topic.substring(17)
                this._pagebus._cache.add(t,mgrSubID)
                var vals=this._pagebus._cache.query(t)
                setTimeout(_sendValues,0)}return mgrSubID},OpenAjax.hub.ManagedHub.prototype.unsubscribeForClient=function(container,managerSubID){this._pagebus._cache.remove(managerSubID)
            try{var sdata=this.getSubscriberData(managerSubID)
                PageBus._cache.isCacheable(sdata)&&this._pagebus._cacheSids[managerSubID]&&(this.unsubscribe(this._pagebus._cacheSids[managerSubID],null,null),delete this._pagebus._cacheSids[managerSubID],this._pagebus._cache.remove(managerSubID)),u4c.call(this,container,managerSubID)}catch(e){PageBus._debug()}}},PageBus._enableMH(),PageBus.HubClientExtender=function(hub,params){var that=this
        this._hub=hub,this._params=params,params.PageBus||(this._params.PageBus={log:params.log}),params.PageBus.policy||(params.PageBus.policy=null),this._policy=params.PageBus.policy,this._cache=new PageBus._cache.Cache,this._cacheSids={},this._wrappedSubscribe=hub.subscribe,this._wrappedUnsubscribe=hub.unsubscribe,this._wrappedPublish=hub.publish,this._wrappedDisconnect=hub.disconnect,hub.publish=function(topic,data){that._publishWrapper(topic,data)},hub.subscribe=function(topic,onData,scope,onComplete,subData){return that._subscribeWrapper(topic,onData,scope,onComplete,subData)},hub.unsubscribe=function(subscriptionID,onComplete,scope){that._unsubscribeWrapper(subscriptionID,onComplete,scope)},hub.disconnect=function(onComplete,scope){that._disconnectWrapper(onComplete,scope)}},PageBus.HubClientExtender.prototype._publishWrapper=function(topic,data){if(!this._hub.isConnected())throw Error(OpenAjax.hub.Error.Disconnected)
        PageBus._assertPubTopic(topic),this._cache.isCaching(topic)&&(null==data?this._cache.clear(topic):this._cache.storeCopy(topic,data))
        var origin=this._hub.getPartnerOrigin()
        if(!origin)throw Error(OpenAjax.hub.Error.Disconnected);(!this._policy||this._policy.onSend(topic,data,origin))&&this._wrappedPublish.call(this._hub,topic,data)},PageBus.HubClientExtender.prototype._subscribeWrapper=function(topic,onData,scope,onComplete,subData){var that=this
        if(!this._hub.isConnected())throw Error(OpenAjax.hub.Error.Disconnected)
        if(PageBus._assertSubTopic(topic),!onData)throw Error(OpenAjax.hub.Error.BadParameters)
        var policy=this._policy,origin=this._hub.getPartnerOrigin()
        if(!origin)throw Error(OpenAjax.hub.Error.Disconnected)
        if(policy&&!policy.onReceive.call(policy,topic,null,origin))throw Error(OpenAjax.hub.Error.NotAllowed)
        dataHook=function(t,d,sd){var policy=that._policy,origin=that._hub.getPartnerOrigin()
            if(!policy||policy.onReceive.call(policy,t,d,origin)){PageBus._cache.isCacheable(sd)&&that._cache.isCaching(t)&&(null==d?that._cache.clear(t):that._cache.storeCopy(t,d))
                try{var s=scope?scope:window
                    onData.call(s,t,d,sd)}catch(e){PageBus._debug()}}},completeHook=function(item,suc,err){suc||that._cacheSids[item]&&(that._hub.unsubscribe(that._cacheSids[item],null,null),delete that._cacheSids[item],that._cache.remove(item))
            try{var s=scope?scope:window
                onComplete.call(s,item,suc,err)}catch(e){PageBus._debug()}}
        var sid=this._wrappedSubscribe.call(this._hub,topic,dataHook,scope,completeHook,subData)
        try{this._hub.getSubscriberData(sid)}catch(e){if(e.message==OpenAjax.hub.Error.NoSubscription)return sid}return PageBus._cache.isCacheable(subData)&&(this._cache.add(topic,sid),this._cacheSids[sid]=this._hub.subscribe("_pagebus.cache.s."+topic,function(t,d){var policy=this._policy,origin=this._hub.getPartnerOrigin()
            if(!policy||this._policy.onReceive(t,d,origin)){PageBus._cache.isCacheable(subData)&&this._cache.isCaching(t)&&(null==d?this._cache.clear(t):this._cache.storeCopy(t,d))
                try{var s=scope?scope:window
                    onData.call(s,t,d,subData)}catch(e){PageBus._debug()}}},this,function(){},null)),sid},PageBus.HubClientExtender.prototype._unsubscribeWrapper=function(subscriptionID,onComplete,scope){if(!this._hub.isConnected())throw Error(OpenAjax.hub.Error.Disconnected)
        if(null==subscriptionID||""==subscriptionID)throw Error(OpenAjax.hub.Error.BadParameters)
        var sdata=this._hub.getSubscriberData(subscriptionID)
        PageBus._cache.isCacheable(sdata)&&this._cacheSids[subscriptionID]&&(this._hub.unsubscribe(this._cacheSids[subscriptionID],null,null),delete this._cacheSids[subscriptionID],this._cache.remove(subscriptionID)),this._wrappedUnsubscribe.call(this._hub,subscriptionID,onComplete,scope)},PageBus.HubClientExtender.prototype._disconnectWrapper=function(onComplete,scope){this._cache._caches.wildcardClear("**"),this._cacheSids={},this._wrappedDisconnect.call(this._hub,onComplete,scope)},PageBus.HubClientExtender.prototype.query=function(topic){return this._cache.query(topic)},PageBus.HubClientExtender.prototype.store=function(topic,data){if(!this._cache.isCaching(topic))throw Error(PageBus.cache.Error.NoCache)
        this._hub.publish(topic,data)},PageBus.HubClientExtender.prototype.clear=function(topic){if(!this._cache.isCaching(topic))throw Error(PageBus.cache.Error.NoCache)
        this._hub.publish(topic,null)},PageBus.enableHubClientClass=function(hubClass){hubClass.prototype._pagebusWrappedConnect=hubClass.prototype.connect,hubClass.prototype.connect=function(onComplete,scope){var hub=this
        hub.pagebus||(hub.pagebus=new PageBus.HubClientExtender(hub,hub.getParameters())),hub._pagebusWrappedConnect.call(hub,onComplete,scope)}},!OpenAjax.hub,OpenAjax.hub.InlineHubClient&&PageBus.enableHubClientClass(OpenAjax.hub.InlineHubClient),OpenAjax.hub.IframeHubClient&&PageBus.enableHubClientClass(OpenAjax.hub.IframeHubClient),OpenAjax.hub._hub=new OpenAjax.hub.ManagedHub({onSubscribe:function(){return!0},onPublish:function(){return!0}}),OpenAjax.hub.subscribe=function(topic,onData,scope,subscriberData){return"string"==typeof onData&&(scope=scope||window,onData=scope[onData]||null),OpenAjax.hub._hub.subscribe(topic,onData,scope,null,subscriberData)},OpenAjax.hub.unsubscribe=function(subscriptionID){return OpenAjax.hub._hub.unsubscribe(subscriptionID)},OpenAjax.hub.publish=function(topic,data){OpenAjax.hub._hub.publish(topic,data)},PageBus.publish=function(topic,data){OpenAjax.hub.publish(topic,data)},PageBus.subscribe=function(topic,scope,onData,subscriberData){return OpenAjax.hub.subscribe(topic,onData,scope,subscriberData)},PageBus.unsubscribe=function(sub){OpenAjax.hub.unsubscribe(sub)},PageBus.store=function(topic,data){OpenAjax.hub._hub.pagebus.store(topic,data)},PageBus.query=function(topic){return OpenAjax.hub._hub.pagebus.query(topic)},OpenAjax.hub.registerLibrary("PageBus","http://pagebus.org/pagebus","2.0",{}),{openAjax:OpenAjax,smash:smash}})
